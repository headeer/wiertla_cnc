{% comment %} 
              Drill Stats and Navigation Table Component
              Displays company statistics and drill category navigation in a table format 
{% endcomment %}

<div class="drill-stats-table">
  <div class="stats-section">
    <div class="stat-group">
      <div class="stat-cell">
        <img
          src="/assets/image-36.png"
          loading="lazy"
          alt="Tools"
          class="stat-icon">
        <div class="stat-content">
          <div class="stat-title">999+ narzędzi CNC</div>
          <div class="stat-description">
            <span>
              <p>Ponad 1000 szt wierteł CNC</p>
              <p>na stanie magazynowym</p>
            </span>
          </div>
        </div>
      </div>
    </div>

    <div class="stat-group">
      <div class="stat-cell">
        <img
          src="/assets/image-38.png"
          loading="lazy"
          alt="Years"
          class="stat-icon">
        <div class="stat-content">
          <div class="stat-title">8 lat na rynku</div>
          <div class="stat-description">
            <span>
              <p>Budujemy mocną pozycję</p>
              <p>jako dostawca narzędzi CNC</p>
            </span>
          </div>
        </div>
      </div>
    </div>

    <div class="stat-group">
      <div class="stat-cell">
        <img
          src="/assets/image-24.png"
          loading="lazy"
          alt="Quality"
          class="stat-icon">
        <div class="stat-content">
          <div class="stat-title">Najwyższa jakość</div>
          <div class="stat-description">
            <span>
              <p>Oferujemy markowe wiertła,</p>
              <p>a także dedykowane zamienniki</p>
            </span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="nav-section">
    <div class="nav-container">
      <div class="nav-items">
        <div class="nav-item">
          <a
            href="#"
            class="nav-link wiertla-categories__icon-item active"
            data-category="wszystkie">
            <div class="nav-content">
              <div class="nav-label">WIERTŁA CNC</div>
              <div>Wszystkie</div>
            </div>
          </a>
        </div>
        <div class="nav-item">
          <a
            href="#"
            class="nav-link wiertla-categories__icon-item"
            data-category="koronkowe">
            <div class="nav-content">
              <div class="nav-label" style="text-decoration: none;">WIERTŁA CNC</div>
              <div>Koronkowe</div>
            </div>
          </a>
        </div>
        <div class="nav-item">
          <a
            href="#"
            class="nav-link wiertla-categories__icon-item"
            data-category="plytkowe">
            <div class="nav-content">
              <div class="nav-label">WIERTŁA CNC</div>
              <div>Płytkowe</div>
            </div>
          </a>
        </div>
        <div class="nav-item">
          <a
            href="#"
            class="nav-link wiertla-categories__icon-item"
            data-category="vhm">
            <div class="nav-content">
              <div class="nav-label">WIERTŁA CNC</div>
              <div>VHM</div>
            </div>
          </a>
        </div>
        <div class="nav-item">
          <a
            href="#"
            class="nav-link wiertla-categories__icon-item"
            data-category="sandvik">
            <div class="nav-content">
              <div class="nav-label">WIERTŁA CNC</div>
              <div>SanDavik 880</div>
            </div>
          </a>
        </div>
        <div class="nav-item">
          <a
            href="#"
            class="nav-link wiertla-categories__icon-item"
            data-category="amec">
            <div class="nav-content">
              <div class="nav-label">WIERTŁA CNC</div>
              <div>AMEC</div>
            </div>
          </a>
        </div>
        <div class="nav-item">
          <a
            href="#"
            class="nav-link wiertla-categories__icon-item"
            data-category="ksem">
            <div class="nav-content">
              <div class="nav-label">WIERTŁA CNC</div>
              <div>KSEM</div>
            </div>
          </a>
        </div>
      </div>
    </div>
  </div>
</div>

{% schema %}
  {
    "name": "Drill Stats Table",
    "settings": [],
    "presets": [
      {
        "name": "Drill Stats Table",
        "category": "Custom Components"
      }
    ]
  }
{% endschema %}

<style>
  .drill-stats-table {
    align-self: stretch;
  }

  .stats-section {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    justify-content: center;
    gap: 1.25rem;
    background-color: rgb(243 244 246);
    padding: 60px 16rem;
  }

  .stat-group {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    justify-content: center;
    gap: 1.25rem;
  }

  .stat-cell {
    display: flex;
    align-items: center;
    gap: 1.25rem;
  }

  .stat-icon {
    height: 8rem;
    width: 8rem;
    flex-shrink: 0;
    object-fit: cover;
    object-position: center;
  }

  .stat-content {
    display: flex;
    width: 20rem;
    flex-shrink: 0;
    flex-direction: column;
    gap: 0.625rem;
  }

  .stat-title {
    font-family: 'League Spartan'
    , sans-serif;
    font-size: 1.125rem;
    font-weight: 700;
    text-transform: uppercase;
    line-height: 17px;
    letter-spacing: 0.96px;
  }

  .stat-description {
    width: 15rem;
  }

  .nav-section {
    height: 5rem;
    flex-shrink: 0;
  }

  .nav-container {
    margin-bottom: -0.125rem;
    display: flex;
    height: 5rem;
    flex-shrink: 0;
    align-items: center;
    justify-content: center;
    border-top: 2px solid rgb(228 228 231);
    background-color: rgb(243 244 246);
    padding: 1.125rem 18rem 1.25rem 16rem;
  }

  .nav-items {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    justify-content: center;
    gap: 3.75rem 1.25rem;
    flex-grow: 1;
    padding-top: 0.125rem;
  }

  .nav-item {}

.nav-link {
  text-decoration: none;
  color: inherit;
  cursor: pointer;
}
.wiertla-stats {
  background-color: #F5F5F8;
  padding: 60px 0;
}
.drill-stats-table {
  align-self: stretch;
}

.stats-section {
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  justify-content: center;
  gap: 1.25rem;
  background-color: rgb(243 244 246);
  padding: 60px 16rem;
}

.stat-group {
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  justify-content: center;
  gap: 1.25rem;
}

.stat-cell {
  display: flex;
  align-items: center;
  gap: 1.25rem;
}

.stat-icon {
  height: 8rem;
  width: 8rem;
  flex-shrink: 0;
  object-fit: cover;
  object-position: center;
}

.stat-content {
  display: flex;
  width: 20rem;
  flex-shrink: 0;
  flex-direction: column;
  gap: 0.625rem;
}

.stat-title {
  font-family: 'League Spartan'
  , sans-serif;
  font-size: 1.125rem;
  font-weight: 700;
  text-transform: uppercase;
  line-height: 17px;
  letter-spacing: 0.96px;
}

.stat-description {
  width: 15rem;
}

.nav-section {
  height: 5rem;
  flex-shrink: 0;

}

.nav-container {
  margin-bottom: -0.125rem;
  display: flex;
  height: 5rem;
  flex-shrink: 0;
  align-items: center;
  justify-content: center;
  border-top: 2px dashed rgb(228 228 231);
  background-color: rgb(243 244 246);
  padding: 1.125rem 18rem 1.25rem 16rem;
}

.nav-items {
  display: flex;
  flex-wrap: nowrap;
  align-items: center;
  justify-content: space-between;
  gap: 3.75rem 1.25rem;
  flex-grow: 1;
  padding-top: 0.125rem;
}

.nav-item {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.625rem;
}

.nav-link {
  text-decoration: none;
  color: inherit;
  cursor: pointer;
}

.nav-link:not(.active) {
  text-decoration: none;

}

.nav-content {
  flex-grow: 1;
  max-width: 8.5rem;
  display: flex;
  flex-direction: row;

}
.nav-content > div {
  font-family: "Montserrat";
  font-weight: 500;
  font-size: 16px;
  line-height: 22px;
  letter-spacing: 0.03em;

}
.nav-content .nav-label {
  font-size: 0.75rem;
  font-weight: 700;
  line-height: 1rem;
  letter-spacing: 0.16px;
  font-family: "Montserrat";
  font-weight: 700;
  font-size: 12px;
  line-height: 16px;
  letter-spacing: 0.01em;
  text-decoration: none;

}

@media (min-width: 1910px) {
  .stats-section,
  .nav-items {
    flex-wrap: nowrap;
  }
}

@media (max-width: 1909px) {
  .stats-section,
  .nav-container {
    padding-left: 1rem;
    padding-right: 1rem;
  }
}
.wiertla-stats__container {
  max-width: 1420px;
  margin: 0 auto;
  display: flex;
  justify-content: space-between;
  gap: 20px;
}

.wiertla-stats__item {
  display: flex;
  align-items: center;
  gap: 20px;
}

.wiertla-stats__icon {
  width: 128px;
  height: 128px;
  flex-shrink: 0;
  object-fit: cover;
}

.wiertla-stats__content {
  display: flex;
  flex-direction: column;
  gap: 10px;
  max-width: 320px;
}

.wiertla-stats__title {
  font-family: "League Spartan";
  font-size: 18px;
  font-weight: 700;
  line-height: 17px;
  letter-spacing: 0.06em;
  text-transform: uppercase;
}

.wiertla-stats__text {
  font-family: "Montserrat";
  font-size: 16px;
  font-weight: 500;
  line-height: 22px;
  letter-spacing: 0.06em;
  color: #112832;
}

@media (max-width: 1024px) {
  .wiertla-stats__container {
    flex-direction: column;
      align-items: flex-start;
    padding: 0 32px;
  }
}

@media (max-width: 768px) {
  .wiertla-stats__container {
    padding: 0 16px;
  }

  .wiertla-stats__item {
    flex-direction: row;
    align-items: center;
    text-align: left;
  }
}
.nav-link:not(.active) {}

.nav-content {
  flex-grow: 1;
  max-width: 8.5rem;
}

.nav-label {
  font-size: 0.75rem;
  font-weight: 700;
  line-height: 1rem;
  letter-spacing: 0.16px;
}

@media (min-width: 1910px) {
  .stats-section,
  .nav-items {
    flex-wrap: nowrap;
  }
}

@media (max-width: 1909px) {
  .stats-section,
  .nav-container {
    padding-left: 1rem;
    padding-right: 1rem;
  }
}
</style>

<script>
  document.addEventListener('DOMContentLoaded', function() {
  const navLinks = document.querySelectorAll('.wiertla-categories__icon-item');
  
  // Only add event listeners if we have navigation links
  if (navLinks && navLinks.length > 0) {
    const producerDropdown = document.querySelector('.wiertla-categories__producer-select');
    
    navLinks.forEach(link => {
      link.addEventListener('click', function(e) {
        e.preventDefault();
        
        // Remove active class from all links
        navLinks.forEach(l => l.classList.remove('active'));
        
        // Add active class to clicked link
        this.classList.add('active');
        
        const category = this.getAttribute('data-category');
        
        // Update dropdown if it exists
        if (producerDropdown) {
          producerDropdown.value = category;
          
          // Trigger change event on dropdown
          const event = new Event('change');
          producerDropdown.dispatchEvent(event);
        }
        
        // Activate wiertla main type and set category in main system
        activateWiertlaMainTypeAndCategory(category);
        
        // Sort table based on category
        sortTableByCategory(category);
      });
    });
  }
  
  function activateWiertlaMainTypeAndCategory(category) {
    try {
      // Ensure WiertlaCNC object exists
      if (!window.WiertlaCNC) {
        window.WiertlaCNC = {};
      }
      
      // Set active tab type to 'wiertla'
      window.WiertlaCNC.activeTabType = 'wiertla';
      
      // Update URL parameter for main type
      const url = new URL(window.location.href);
      url.searchParams.set('mainType', 'wiertla');
      window.history.replaceState({}, '', url.toString());
      
      // Set the category in the main filter system
      if (!window.WiertlaCNC.filters) {
        window.WiertlaCNC.filters = {
          category: 'wszystkie',
          status: 'all',
          type: 'all',
          crown: 'all',
          manufacturer: 'all',
          page: 1,
          perPage: 100,
        };
      }
      
      // Map drill stats categories to wiertla categories
      const categoryMapping = {
        'wszystkie': 'wszystkie',
        'koronkowe': 'koronkowe',
        'plytkowe': 'plytkowe',
        'vhm': 'vhm',
        'sandvik': 'sandvik',
        'amec': 'amec',
        'ksem': 'ksem'
      };
      
      const mappedCategory = categoryMapping[category] || 'wszystkie';
      window.WiertlaCNC.filters.category = mappedCategory;
      window.selectedCategory = mappedCategory;
      
      // Reset pagination
      window.WiertlaCNC.filters.page = 1;
      window.currentPage = 1;
      
      // Update URL parameters
      if (typeof updateUrlParams === 'function') {
        updateUrlParams();
      }
      
      // Apply filters if the function exists
      if (typeof applyFilters === 'function') {
        applyFilters();
      }
      
      // Update active states in main navigation
      updateMainNavigationActiveStates(mappedCategory);
      
    } catch (error) {
      console.error('Error activating wiertla main type and category:', error);
    }
  }
  
  function updateMainNavigationActiveStates(category) {
    try {
      // Remove active class from all category items in main navigation
      const mainCategoryItems = document.querySelectorAll('.wiertla-categories__icon-item');
      mainCategoryItems.forEach(item => {
        item.classList.remove('active');
      });
      
      // Add active class to the selected category
      const activeCategoryItem = document.querySelector(`.wiertla-categories__icon-item[data-category="${category}"]`);
      if (activeCategoryItem) {
        activeCategoryItem.classList.add('active');
      }
      
      // Update main type selector if it exists
      const mainTypeSelect = document.querySelector('select[name="mainType"]');
      if (mainTypeSelect) {
        mainTypeSelect.value = 'wiertla';
      }
      
    } catch (error) {
      console.error('Error updating main navigation active states:', error);
    }
  }
  
  function sortTableByCategory(category) {
    const table = document.querySelector('.wiertla-categories__table');
    if (!table) return;
    
    const rows = Array.from(table.querySelectorAll('tr:not(:first-child)'));
    if (rows.length === 0) return;
    
    const tbody = table.querySelector('tbody');
    if (!tbody) return;
    
    if (category === 'wszystkie') {
      // Reset to original order
      rows.sort((a, b) => {
        const aIndex = parseInt(a.getAttribute('data-original-index')) || 0;
        const bIndex = parseInt(b.getAttribute('data-original-index')) || 0;
        return aIndex - bIndex;
      });
    } else {
      // Sort by selected category
      rows.sort((a, b) => {
        const aProducer = a.querySelector('[data-producer]')?.getAttribute('data-producer')?.toLowerCase() || '';
        const bProducer = b.querySelector('[data-producer]')?.getAttribute('data-producer')?.toLowerCase() || '';
        
        if (aProducer.includes(category)) return -1;
        if (bProducer.includes(category)) return 1;
        return 0;
      });
    }
    
    // Clear and repopulate table
    rows.forEach(row => tbody.appendChild(row));
  }
  });
</script>