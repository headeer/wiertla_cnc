{% comment %} 
                                                                                                          Wiertla Categories Component
                                                                                                          A component to display product categories and search functionality for the Wiertla CNC Shopify theme. 
{% endcomment %}
{{ 'wiertla-categories.css' | asset_url | stylesheet_tag }}
{{ 'wiertla-filter-modal.css' | asset_url | stylesheet_tag }}

{% assign section_id = section.id %}
{% assign items_per_page = section.settings.items_per_page | default: 20 %}

{% if section.settings.selected_collection != blank %}
  {% assign selected_collection = collections[section.settings.selected_collection] %}
{% else %}
  {% assign selected_collection = collections.all %}
{% endif %}

{% assign current_language = request.locale.iso_code | default: 'pl' %}

  {% paginate selected_collection.products by 2000 %}
  <div class="wiertla-categories__container">
    <div class="wiertla-categories__tabs desktop">
      <button class="wiertla-categories__tab active" data-translate="wiertla_categories.tabs.plates_for_drills">PŁYTKI DO WIERTEŁ</button>
      <button class="wiertla-categories__tab" data-translate="wiertla_categories.tabs.crowns_for_drills">KORONKI DO WIERTEŁ</button>
      <button class="wiertla-categories__tab" data-translate="wiertla_categories.tabs.crown_regeneration">REGENERACJA KORONEK KSEM</button>
    </div>
  </div>
  <div class="wiertla-categories">
    <div class="wiertla-categories__container">
      <div class="wiertla-logos--mobile">
        {% render 'wiertla-categories-logos' %}
      </div>


      <div class="wiertla-categories__tabs mobile">
        <button class="wiertla-categories__tab active" data-translate="wiertla_categories.tabs.plates_short">PŁYTKI</button>
        <button class="wiertla-categories__tab" data-translate="wiertla_categories.tabs.crowns_short">KORONKI</button>
        <button class="wiertla-categories__tab" data-translate="wiertla_categories.tabs.regeneration">REGENERACJA</button>
      </div>

      <div class="wiertla-categories__status-filters--mobile">
        <button class="wiertla-categories__status-filter" data-translate="wiertla_categories.status_filters.new">Nowe</button>
        <button class="wiertla-categories__status-filter wider" data-translate="wiertla_categories.status_filters.used">Używane</button>
      </div>
      <div class="wiertla-categories__icons mobile">
        <div class="wiertla-categories__icon-item" data-category="wszystkie">
          <img
            src="{{ 'ico_big_all.svg' | asset_url }}"
            alt="Wszystkie"
            class="wiertla-categories__icon"
            width="24"
            height="24">
          <span class="wiertla-categories__icon-label" data-translate="wiertla_categories.icons.all">WSZYSTKIE</span>
        </div>
        <div class="wiertla-categories__icon-item" data-category="koronkowe">
          <img
            src="{{ 'ico_big_koronkowe.svg' | asset_url }}"
            alt="Koronkowe"
            class="wiertla-categories__icon"
            width="24"
            height="24">
          <span class="wiertla-categories__icon-label" data-translate="wiertla_categories.icons.crown">KORONKOWE</span>
        </div>
        <div class="wiertla-categories__icon-item" data-category="plytkowe">
          <img
            src="{{ 'ico_big_plytkowe.svg' | asset_url }}"
            alt="Płytkowe"
            class="wiertla-categories__icon"
            width="24"
            height="24">
          <span class="wiertla-categories__icon-label" data-translate="wiertla_categories.icons.plate">PŁYTKOWE</span>
        </div>
        <div class="wiertla-categories__icon-item" data-category="vhm">
          <img
            src="{{ 'ico_big_vhm.svg' | asset_url }}"
            alt="VH"
            class="wiertla-categories__icon"
            width="24"
            height="24">
          <span class="wiertla-categories__icon-label" data-translate="wiertla_categories.icons.vhm">VHM</span>
        </div>
        <div class="wiertla-categories__icon-item" data-category="sandvik">
          <img
            src="{{ 'ico_big_sandvik.svg' | asset_url }}"
            alt="Sandvik 880"
            class="wiertla-categories__icon"
            width="24"
            height="24">
          <span class="wiertla-categories__icon-label" data-translate="wiertla_categories.icons.sandvik">SANDVIK 880</span>
        </div>
        <div class="wiertla-categories__icon-item" data-category="amec">
          <img
            src="{{ 'ico_big_amec.svg' | asset_url }}"
            alt="AMEC"
            class="wiertla-categories__icon"
            width="24"
            height="24">
          <span class="wiertla-categories__icon-label" data-translate="wiertla_categories.icons.amec">AMEC</span>
        </div>
        <div class="wiertla-categories__icon-item" data-category="ksem">
          <img
            src="{{ 'ico_big_ksem.svg' | asset_url }}"
            alt="KSEM"
            class="wiertla-categories__icon"
            width="24"
            height="24">
          <span class="wiertla-categories__icon-label" data-translate="wiertla_categories.icons.ksem">KSEM</span>
        </div>

    </div>
      <!-- Mobile Header (Only visible on mobile) -->
      {% render 'wiertla-categories-mobile-header'
        , section: section %}

      <!-- Desktop Header (Only visible on desktop) -->
      <div class="wiertla-categories__header desktop">
        <div class="wiertla-categories__filters">
          <!-- New Status Filters -->
          <div class="wiertla-categories__status-filters desktop">
            <button class="wiertla-categories__status-filter active" data-translate="wiertla_categories.status_filters.new">Nowe</button>
            <button class="wiertla-categories__status-filter wider" data-translate="wiertla_categories.status_filters.used">Używane</button>
          </div>

          <!-- Filter button -->
          <div class="wiertla-categories__filters-button-wrapper mobile">
            <button class="wiertla-categories__filters-button">
              <span data-translate="wiertla_categories.filters.button">Filtry</span>
              <div class="wiertla-categories__filters-button-icon"></div>
            </button>
        </div>

          <!-- Include Category Filters Component -->
          {% render 'wiertla-categories-filters' %}
        </div>
    </div>


      <!-- Mobile Filter Modal (Hidden by default) -->
      {% render 'wiertla-categories-mobile' %}
    </div>
  </div>
  <div class="wiertla-categories bg_neutral">
    <div class="wiertla-categories__container">
      <!-- Table Content -->
      <div class="wiertla-categories__content wiertla-categories__layout">
        <!-- Left Column -->
        <div class="wiertla-categories__left-column">
          <!-- Include Search Component -->
        {% render 'wiertla-categories-search' %}

          <!-- Include Mobile Tabs (Only visible on mobile) -->
          {% render 'wiertla-categories-tabs-mobile' %}
        </div>

        <!-- Right Column -->
        <div class="wiertla-categories__right-column">
          <!-- Include Table Component -->
          {% render 'wiertla-categories-table' %}

        </div>
      </div>
    </div>
</div>
  <!-- Include Fullscreen Component -->
  {% render 'wiertla-categories-fullscreen' %}

  <!-- Include scripts directly -->
  <script>
      // Define isMobileView at the very start so it's available throughout the codebase
      let isMobileView = window.innerWidth <= 768;
    
      // Ensure we call applyFilters when the script runs
      document.addEventListener('DOMContentLoaded', function() {
    
    // Force check mobile view
    isMobileView = window.innerWidth <= 768;
    
    // Small delay to ensure everything is loaded
    setTimeout(function() {
      applyFilters();
      
      // Force another check after a short delay in case of any race conditions
      setTimeout(function() {
        const currentIsMobileView = window.innerWidth <= 768;
        if (currentIsMobileView !== isMobileView) {
          isMobileView = currentIsMobileView;
          applyFilters();
        }
      }, 500);
    }, 100);
      });
    
      // Get products from selected collection
      var wiertlaProducts =[];
        {% for product in selected_collection.products %}
        wiertlaProducts.push({
          // Basic Information
          id: {{ product.id | json }},
          title: {{ product.title | json }},
          handle: {{ product.handle | json }},
          sku: {{ product.first_available_variant.sku | json }},
          description: {{ product.description | json }},
          type: {{ product.type | json }},
          vendor: {{ product.vendor | json }},
          tags: {{ product.tags | json }},
          published_at: {{ product.published_at | json }},
          created_at: {{ product.created_at | json }},
          updated_at: {{ product.updated_at | json }},
          custom_fi: {{ product.metafields.custom.fi | json }},
          custom_symbol: {{ product.metafields.custom.symbol | json }},
          custom_category: {{ product.metafields.custom.category | json }},
          custom_drill_length: {{ product.metafields.custom.drill_length | json }},
          custom_rent: {{ product.metafields.custom.rent | json }},
          custom_srednica: {{ product.metafields.custom._rednica | json }},
          custom_kod_producenta: {{ product.metafields.custom.kod_producenta | json }},
          custom_manufacturer: {{ product.metafields.custom.manufacturer | json }},
          custom_working_length: {{ product.metafields.custom.working_length.value | json }},
          custom_xd: {{ product.metafields.custom.xd | json }},
          // Pricing and Availability
          price: {{ product.price | money_without_trailing_zeros | json }},
          price_min: {{ product.price_min | money_without_trailing_zeros | json }},
          price_max: {{ product.price_max | money_without_trailing_zeros | json }},
          price_varies: {{ product.price_varies | json }},
          compare_at_price: {{ product.compare_at_price | money_without_trailing_zeros | json }},
          compare_at_price_min: {{ product.compare_at_price_min | money_without_trailing_zeros | json }},
          compare_at_price_max: {{ product.compare_at_price_max | money_without_trailing_zeros | json }},
          compare_at_price_varies: {{ product.compare_at_price_varies | json }},
          available: {{ product.available | json }},
          
          // Variants
          variants: [
            {% for variant in product.variants %}
              {
                id: {{ variant.id | json }},
                title: {{ variant.title | json }},
                sku: {{ variant.sku | json }},
                barcode: {{ variant.barcode | json }},
                price: {{ variant.price | money_without_trailing_zeros | json }},
                compare_at_price: {{ variant.compare_at_price | money_without_trailing_zeros | json }},
                weight: {{ variant.weight | json }},
                weight_unit: {{ variant.weight_unit | json }},
                available: {{ variant.available | json }},
                inventory_quantity: {{ variant.inventory_quantity | json }},
                inventory_policy: {{ variant.inventory_policy | json }},
                inventory_management: {{ variant.inventory_management | json }},
                option1: {{ variant.option1 | json }},
                option2: {{ variant.option2 | json }},
                option3: {{ variant.option3 | json }}
              }{% unless forloop.last %},{% endunless %}
            {% endfor %}
          ],
          
          // Options
          options: [
            {% for option in product.options %}
              {
                name: {{ option.name | json }},
                position: {{ option.position | json }},
                values: {{ option.values | json }}
              }{% unless forloop.last %},{% endunless %}
            {% endfor %}
          ],
          
          // Images
          images: [
            {% for image in product.images %}
              {
                id: {{ image.id | json }},
                src: {{ image | img_url: 'master' | json }},
                alt: {{ image.alt | json }},
                width: {{ image.width | json }},
                height: {{ image.height | json }},
                position: {{ image.position | json }}
              }{% unless forloop.last %},{% endunless %}
            {% endfor %}
          ],
          featured_image: {{ product.featured_image | img_url: 'master' | json }},
          
          // Metafields
          metafields: {
            custom: {
              diameter: {{ product.metafields.custom.diameter.value | json }},
              length: {{ product.metafields.custom.length.value | json }},
              symbol: {{ product.metafields.custom.symbol.value | json }},
              rentable: {{ product.metafields.custom.rentable.value | json }},
              rent: {{ product.metafields.custom.rent.value | json }},
              cooling: {{ product.metafields.custom.cooling.value | json }},
              working_length: {{ product.metafields.custom.working_length.value | json }},
              notes: {{ product.metafields.custom.notes.value | json }},
              mounting: {{ product.metafields.custom.mounting.value | json }},
              condition: {{ product.metafields.custom.condition.value | json }},
              manufacturer: {{ product.metafields.custom.manufacturer.value | json }},
              width: {{ product.metafields.custom.width.value | json }},
              height: {{ product.metafields.custom.height.value | json }},
              custom_category: {{ product.metafields.custom.custom_category.value | json }}
            }
          },
          
          // Collections
          collections: [
            {% for collection in product.collections %}
              {
                id: {{ collection.id | json }},
                title: {{ collection.title | json }},
                handle: {{ collection.handle | json }}
              }{% unless forloop.last %},{% endunless %}
            {% endfor %}
          ]
        });
      {% endfor %}
      // Assign products to global WiertlaCNC object
      window.WiertlaCNC = window.WiertlaCNC || {};
      window.WiertlaCNC.products = wiertlaProducts;
      
      // Define openRentModal function
      window.WiertlaCNC.openRentModal = function(product) {
        const modal = document.querySelector('.wiertla-categories__mobile-rent-modal');
        if (!modal) {
          console.error('Rent modal not found');
          return;
        }

        // Update modal content
        const title = modal.querySelector('.wiertla-categories__mobile-rent-title');
        if (title) {
          title.textContent = product.title;
        }

        // Show the modal
        modal.classList.add('active');
        document.body.style.overflow = 'hidden';
        // Add close handler
        const closeButton = modal.querySelector('.wiertla-categories__mobile-rent-close');
        if (closeButton) {
          closeButton.onclick = function() {
            modal.style.display = 'none';
            document.body.style.overflow = '';
          };
        }

        // Add click outside handler
        modal.onclick = function(event) {
          if (event.target === modal) {
            modal.style.display = 'none';
            document.body.style.overflow = '';
          }
        };
      };
      
      // Language switcher API - This is being replaced by our new translation system
      window.WiertlaCNC.changeLanguage = function(language) {
    // Use our new WiertlaTranslator instead
    if (window.WiertlaTranslator && typeof window.WiertlaTranslator.changeLanguage === 'function') {
      window.WiertlaTranslator.changeLanguage(language);
    }
      };
      
      document.addEventListener('DOMContentLoaded', function() {
    
    // Initialize mobile filter bar
    const mobileFilterBar = document.querySelector('.wiertla-categories__mobile-filter-bar');
    const mobileFilterModal = document.querySelector('.wiertla-categories__mobile-filter-modal');
    
    if (mobileFilterBar) {
      // Add click event for the filter button
      const filterButton = mobileFilterBar.querySelector('.wiertla-categories__mobile-filter-left');
      if (filterButton) {
        filterButton.addEventListener('click', function() {
          if (mobileFilterModal) {
            mobileFilterModal.classList.add('active');
            document.body.style.overflow = 'hidden'; // Prevent scrolling
          }
        });
      }
      
      // Add click events for per page buttons
      const perPageButtons = mobileFilterBar.querySelectorAll('.wiertla-categories__mobile-per-page-button');
      perPageButtons.forEach(button => {
        button.addEventListener('click', function() {
          // Remove active class from all buttons
          perPageButtons.forEach(btn => btn.classList.remove('active'));
          
          // Add active class to clicked button
          button.classList.add('active');
          
          // Update items per page
          const newItemsPerPage = parseInt(button.getAttribute('data-items'));
          if (newItemsPerPage && !isNaN(newItemsPerPage)) {
            itemsPerPage = newItemsPerPage;
            currentPage = 1; // Reset to first page
            applyFilters(); // Refresh the table
          }
        });
      });
    }
    
    // Handle mobile per-page buttons independently since they might not be in the filter bar
    const mobilePerPageButtons = document.querySelectorAll('.wiertla-categories__mobile-per-page-button');
    mobilePerPageButtons.forEach(button => {
      button.addEventListener('click', function() {
        // Remove active class from all buttons
        mobilePerPageButtons.forEach(btn => btn.classList.remove('active'));
        
        // Add active class to clicked button
        button.classList.add('active');
        
        // Update items per page
        const newItemsPerPage = parseInt(button.getAttribute('data-items') || button.getAttribute('data-value'));
        if (newItemsPerPage && !isNaN(newItemsPerPage)) {
          itemsPerPage = newItemsPerPage;
          currentPage = 1; // Reset to first page
          applyFilters(); // Refresh the table
        }
      });
    });
    
    // Make sure the filter modal close button works
    const filterModalCloseButton = document.querySelector('.wiertla-categories__mobile-filter-close');
    if (filterModalCloseButton) {
      filterModalCloseButton.addEventListener('click', function() {
        if (mobileFilterModal) {
          mobileFilterModal.classList.remove('active');
          document.body.style.overflow = ''; // Allow scrolling again
        }
      });
    }
    
    
    // Initialize product table data
    let allProducts = wiertlaProducts;
    // Create hover preview element
    const hoverPreview = document.createElement('div');
    hoverPreview.className = 'wiertla-categories__hover-preview';
    hoverPreview.innerHTML = `
      <div class="wiertla-categories__hover-preview-inner">
        <img src="" alt="Preview" class="wiertla-categories__hover-preview-img">
        <div class="wiertla-categories__hover-preview-arrow"></div>
      </div>
    `;
    document.body.appendChild(hoverPreview);
    
    // Create new image hover element
    const newImageHover = document.createElement('div');
    newImageHover.className = 'wiertla-categories__image-hover';
    newImageHover.innerHTML = `
      <div class="wiertla-categories__image-hover-inner">
        <img src="" alt="Preview" class="wiertla-categories__image-hover-img">
        <div class="wiertla-categories__image-hover-diamond">
          <img src="{{ 'diamond.svg' | asset_url }}" alt="Diamond" width="14" height="28">
        </div>
      </div>
    `;
    document.body.appendChild(newImageHover);
    
    // Set search input placeholder
    const searchInput = document.querySelector('.wiertla-search__input');
    if (searchInput) {
      searchInput.placeholder = "fi / nazwa / symbol / producent";
    } else {
      console.error('Search input not found');
    }
    
    // Initialize variables
    window.currentPage = 1;
    window.itemsPerPage = {{ section.settings.items_per_page | default: 20 }};
    window.totalPages = 1;
    window.selectedCategory = 'wszystkie';
    window.currentFilters = {
      type: '',
      crown: '',
      manufacturer: '',
      search: ''
    };
    
    // Detect Shopify language from the html lang attribute
    let shopifyLanguage = document.documentElement.lang || 'pl';
    
    // Initialize translations based on Shopify language
    const translations = {
      'pl': {
        // Table and filters
        'no_results': 'Brak wyników spełniających kryteria',
        'results_format': '{0}-{1} z {2}',
        'show_previous': 'POKAŻ POPRZEDNIE',
        'show_next': 'POKAŻ NASTĘPNE',
        'preview_title': 'ZOBACZ OBRAZ POGLĄDOWY',
        'preview_instruction': 'Najedź kursorem na wiertło w tabeli, aby wyświetlić tu powiększony podgląd',
        'fullscreen_title': 'WIERTŁA CNC',
        'fullscreen_description': 'Wybierz interesujące Cię wiertło z bogatej oferty naszego sklepu.',
        'close_fullscreen': 'Zamknij tryb pełnoekranowy',
        
        // Categories and filters
        'all': 'Wszystkie',
        'drill_type': 'Typ wiertła',
        'crown_type': 'Wykaz koronek',
        'manufacturer': 'Producent',
        'show': 'Pokaż',
        'per_page': '/ na stronę',
        
        // Table headers
        'type': 'Typ',
        'diameter': '⌀ Fi',
        'length': 'D/mm',
        'symbol': 'Symbol',
        'vendor': 'Producent',
        'price': 'Cena netto',
        
        // Categories
        'crown': 'KORONKOWE',
        'plate': 'PŁYTKOWE',
        'vhm': 'VHM',
        'sandvik': 'SANDVIK 880',
        'amec': 'AMEC',
        'ksem': 'KSEM',
        'all_categories': 'WSZYSTKIE',
        'show_previous_mobile': 'POPRZEDNIE',
        'show_next_mobile': 'NASTĘPNE'
      },
      'en': {
        // Table and filters
        'no_results': 'No results match your criteria',
        'results_format': '{0}-{1} of {2}',
        'show_previous': 'SHOW PREVIOUS',
        'show_next': 'SHOW NEXT',
        'preview_title': 'VIEW PREVIEW IMAGE',
        'preview_instruction': 'Hover over a drill in the table to display an enlarged preview here',
        'fullscreen_title': 'CNC DRILLS',
        'fullscreen_description': 'Choose the drill you are interested in from our store\'s extensive selection.',
        'close_fullscreen': 'CLOSE FULLSCREEN',
        
        // Categories and filters
        'all': 'All',
        'drill_type': 'Drill type',
        'crown_type': 'Crown type',
        'manufacturer': 'Manufacturer',
        'show': 'Show',
        'per_page': '/ per page',
        
        // Table headers
        'type': 'Type',
        'diameter': '⌀ Diameter',
        'length': 'L/mm',
        'symbol': 'Symbol',
        'vendor': 'Manufacturer',
        'price': 'Net price',
        
        // Categories
        'crown': 'CROWN',
        'plate': 'PLATE',
        'vhm': 'VHM',
        'sandvik': 'SANDVIK 880',
        'amec': 'AMEC',
        'ksem': 'KSEM',
        'all_categories': 'ALL',
        'show_previous_mobile': 'PREVIOUS',
        'show_next_mobile': 'NEXT'
      },
      'de': {
        'no_results': 'Keine Ergebnisse entsprechen Ihren Kriterien',
        'results_format': '{0}-{1} von {2}',
        'show_previous': 'VORHERIGE ANZEIGEN',
        'show_next': 'NÄCHSTE ANZEIGEN',
        'preview_title': 'VORSCHAUBILD ANZEIGEN',
        'preview_instruction': 'Fahren Sie mit dem Mauszeiger über einen Bohrer in der Tabelle, um hier eine vergrößerte Vorschau anzuzeigen',
        'fullscreen_title': 'CNC-BOHRER',
        'fullscreen_description': 'Wählen Sie den gewünschten Bohrer aus unserem umfangreichen Sortiment.',
        'close_fullscreen': 'VOLLBILD SCHLIESSEN',
        
        // Categories and filters
        'all': 'Alle',
        'drill_type': 'Bohrertyp',
        'crown_type': 'Kronentyp',
        'manufacturer': 'Hersteller',
        'show': 'Zeigen',
        'per_page': '/ pro Seite',
        
        // Table headers
        'type': 'Typ',
        'diameter': '⌀ Durchmesser',
        'length': 'L/mm',
        'symbol': 'Symbol',
        'vendor': 'Hersteller',
        'price': 'Nettopreis',
        
        // Categories
        'crown': 'KRONE',
        'plate': 'PLATTE',
        'vhm': 'VHM',
        'sandvik': 'SANDVIK 880',
        'amec': 'AMEC',
        'ksem': 'KSEM',
        'all_categories': 'ALLE',
        'show_previous_mobile': 'VORHERIGE',
        'show_next_mobile': 'NÄCHSTE'
      }
    };
    
    // Default to Polish if language not supported
    let currentLanguage = translations[shopifyLanguage] ? shopifyLanguage : 'pl';
    
    // Check for stored language preference first, then use Shopify language or default to Polish
    const storedLanguage = localStorage.getItem('shopify_locale');
    if (storedLanguage && translations[storedLanguage]) {
      currentLanguage = storedLanguage;
    } else {
      currentLanguage = translations[shopifyLanguage] ? shopifyLanguage : 'pl';
    }
    
    // Set the HTML lang attribute to match the selected language
    document.documentElement.lang = currentLanguage;
    
    // Watch for language changes in the Shopify language selector
    document.addEventListener('click', function(e) {
      // Look for Shopify language selector links
      const langLink = e.target.closest('.header__lang-links a, [data-disclosure-locale]');
      if (langLink) {
        e.preventDefault(); // Prevent default to avoid page reload
        const lang = langLink.getAttribute('data-lang');
        if (lang && translations[lang]) {
          window.changeLanguage(lang);
        }
      }
    });
    
    // Make necessary functions globally available
    window.handleCategoryChange = function(category) {
      selectedCategory = category;
      currentPage = 1;
      applyFilters();
    };
    
    window.handleItemsPerPageChange = function(newItemsPerPage) {
      itemsPerPage = parseInt(newItemsPerPage);
      currentPage = 1;
      
      // Sync desktop per-page buttons
      document.querySelectorAll('.wiertla-categories__per-page-button').forEach(function(btn) {
        if (parseInt(btn.getAttribute('data-value')) === itemsPerPage) {
          btn.classList.add('active');
        } else {
          btn.classList.remove('active');
        }
      });
      
      // Sync mobile per-page buttons 
      document.querySelectorAll('.wiertla-categories__mobile-per-page-button').forEach(function(btn) {
        if (parseInt(btn.getAttribute('data-items')) === itemsPerPage) {
          btn.classList.add('active');
        } else {
          btn.classList.remove('active');
        }
      });
      
      applyFilters();
    };
    
    // Function to change language - Remove this in favor of our new translation system
    window.changeLanguage = function(language) {
      // Delegate to our new translation system
      if (window.WiertlaTranslator && typeof window.WiertlaTranslator.changeLanguage === 'function') {
        window.WiertlaTranslator.changeLanguage(language);
      }
    };
    
    // Function to update UI text based on current language
    function updateUILanguage() {
      // Update pagination buttons
      document.querySelectorAll('#prevPage, #fullscreenPrevPage').forEach(btn => {
        const span = btn.querySelector('span');
        if (span) {
          span.textContent = translations[currentLanguage].show_previous;
          span.setAttribute('data-mobile-text', translations[currentLanguage].show_previous_mobile);
        }
      });
      
      document.querySelectorAll('#nextPage, #fullscreenNextPage').forEach(btn => {
        const span = btn.querySelector('span');
        if (span) {
          span.textContent = translations[currentLanguage].show_next;
          span.setAttribute('data-mobile-text', translations[currentLanguage].show_next_mobile);
        }
      });
      
      // Update table headers
      const tableHeaders = document.querySelectorAll('.wiertla-categories__table th');
      if (tableHeaders.length >= 6) {
        tableHeaders[0].textContent = translations[currentLanguage].type;
        tableHeaders[1].textContent = translations[currentLanguage].diameter;
        tableHeaders[2].textContent = translations[currentLanguage].length;
        tableHeaders[3].textContent = translations[currentLanguage].symbol;
        tableHeaders[4].textContent = translations[currentLanguage].vendor;
        tableHeaders[5].textContent = translations[currentLanguage].price;
      }
      
      // Update filter dropdowns
      const typeFilter = document.querySelector('.wiertla-categories__filter[data-filter="type"]');
      if (typeFilter && typeFilter.options.length > 0) {
        typeFilter.options[0].textContent = translations[currentLanguage].drill_type;
      }
      
      const crownFilter = document.querySelector('.wiertla-categories__filter[data-filter="crown"]');
      if (crownFilter && crownFilter.options.length > 0) {
        crownFilter.options[0].textContent = translations[currentLanguage].crown_type;
      }
      
      const manufacturerFilter = document.querySelector('.wiertla-categories__filter[data-filter="manufacturer"]');
      if (manufacturerFilter && manufacturerFilter.options.length > 0) {
        manufacturerFilter.options[0].textContent = translations[currentLanguage].manufacturer;
      }
      
      // Update per-page labels
      document.querySelectorAll('.wiertla-categories__per-page-label').forEach((label, index) => {
        if (index % 2 === 0) {
          label.textContent = translations[currentLanguage].show;
        } else {
          label.textContent = translations[currentLanguage].per_page;
        }
      });
      
      // Update "Wszystkie" button text
      document.querySelectorAll('.wiertla-categories__filter-button[data-filter="wszystkie"]').forEach(btn => {
        btn.textContent = translations[currentLanguage].all;
      });
      
      // Update category icons label text
      document.querySelectorAll('.wiertla-categories__icon-item').forEach(item => {
        const label = item.querySelector('.wiertla-categories__icon-label');
        const category = item.getAttribute('data-category');
        
        if (label && category) {
          switch (category) {
            case 'koronkowe':
              label.textContent = translations[currentLanguage].crown;
              break;
            case 'plytkowe':
              label.textContent = translations[currentLanguage].plate;
              break;
            case 'vhm':
              label.textContent = translations[currentLanguage].vhm;
              break;
            case 'sandvik':
              label.textContent = translations[currentLanguage].sandvik;
              break;
            case 'amec':
              label.textContent = translations[currentLanguage].amec;
              break;
            case 'ksem':
              label.textContent = translations[currentLanguage].ksem;
              break;
            case 'wszystkie':
              label.textContent = translations[currentLanguage].all_categories;
              break;
          }
        }
      });
      
      // Update fullscreen elements if they exist
      const fullscreenTitle = document.querySelector('.wiertla-categories__fullscreen-title h2');
      if (fullscreenTitle) {
        fullscreenTitle.textContent = translations[currentLanguage].fullscreen_title;
      }
      
      const fullscreenDesc = document.querySelector('.wiertla-categories__fullscreen-title p');
      if (fullscreenDesc) {
        fullscreenDesc.textContent = translations[currentLanguage].fullscreen_description;
      }
      
      const fullscreenClose = document.querySelector('.wiertla-categories__fullscreen-close span');
      if (fullscreenClose) {
        fullscreenClose.textContent = translations[currentLanguage].close_fullscreen;
      }
      
      // Update preview elements
      const previewTitle = document.querySelector('.wiertla-categories__preview-title');
      if (previewTitle) {
        previewTitle.textContent = translations[currentLanguage].preview_title;
      }
      
      const previewText = document.querySelector('.wiertla-categories__preview-text');
      if (previewText) {
        previewText.textContent = translations[currentLanguage].preview_instruction;
      }
      
      // Update the results text
      const resultsText = document.querySelector('.wiertla-categories__results-text');
      if (resultsText) {
        resultsText.textContent = 'Wyświetlono wyniki ';
      }
      
      // Re-apply filters to update any text in the table
      applyFilters();
    }
    
    // Calculate initial totalPages
    totalPages = Math.ceil(allProducts.length / itemsPerPage);
    
    // Update hover preview position
    function updatePreviewPosition(e) {
      const previewWidth = hoverPreview.offsetWidth;
      const previewHeight = hoverPreview.offsetHeight;
      
      // Get the position of the table row being hovered
      const tableRow = e.currentTarget;
      const tableRowRect = tableRow.getBoundingClientRect();
      
      // Position the preview to the left of the table row, aligned with the row's vertical center
      let top = tableRowRect.top + window.scrollY - (previewHeight / 2) + (tableRowRect.height / 2);
      
      // Make sure preview stays in viewport vertically
      if (top < window.scrollY) {
        top = window.scrollY + 10;
      } else if (top + previewHeight > window.scrollY + window.innerHeight) {
        top = window.scrollY + window.innerHeight - previewHeight - 10;
      }
      
      // Position horizontally to the left of the table
      const tableContainer = document.querySelector('.wiertla-categories__table-container');
      const tableContainerRect = tableContainer.getBoundingClientRect();
      const left = tableContainerRect.left + window.scrollX - previewWidth - 20;
      
      hoverPreview.style.left = left + 'px';
      hoverPreview.style.top = top + 'px';
      
      // Ensure the element is visible
      if (hoverPreview.classList.contains('active')) {
        hoverPreview.style.display = 'block';
      }
    }
    
    // New function to update the position of the new image hover
    function updateNewImageHoverPosition(e) {
      const previewWidth = newImageHover.offsetWidth;
      const previewHeight = newImageHover.offsetHeight;
      
      // Get the position of the table row being hovered
      const tableRow = e.currentTarget;
      const tableRowRect = tableRow.getBoundingClientRect();
      
      // Position the preview to the left of the table row, aligned with the row's vertical center
      let top = tableRowRect.top + window.scrollY - (previewHeight / 2) + (tableRowRect.height / 2);
      
      // Make sure preview stays in viewport vertically
      if (top < window.scrollY) {
        top = window.scrollY + 10;
      } else if (top + previewHeight > window.scrollY + window.innerHeight) {
        top = window.scrollY + window.innerHeight - previewHeight - 10;
      }
      
      // Position horizontally to the left of the table
      const tableContainer = document.querySelector('.wiertla-categories__table-container');
      const tableContainerRect = tableContainer.getBoundingClientRect();
      const left = tableContainerRect.left + window.scrollX - previewWidth - 20;
      
      newImageHover.style.left = left + 'px';
      newImageHover.style.top = top + 'px';
      
      // Ensure the element is visible
      if (newImageHover.classList.contains('active')) {
        newImageHover.style.display = 'block';
      }
    }
    
    // Filter products based on current filters
    function filterProducts() {
      
      let filteredProducts = window.WiertlaCNC?.products || [];

      if (!Array.isArray(filteredProducts) || filteredProducts.length === 0) {
        return [];
      }

      // Apply condition filter first
      if (window.WiertlaCNC.filters.condition) {
        filteredProducts = filteredProducts.filter(product => {
          // Get condition from both metafields.custom.condition and STAN field
          const condition = product.metafields?.custom?.condition?.value;
          const stan = product.metafields?.custom?.stan?.value;
          
          
          if (!condition && !stan) {
            return false;
          }

          const isNew = window.WiertlaCNC.filters.condition === 'nowe';
          
          // Check both fields - if either matches, include the product
          const conditionMatches = condition && condition.toLowerCase().startsWith(isNew ? 'n' : 'u');
          const stanMatches = stan && stan.toLowerCase().startsWith(isNew ? 'n' : 'u');
          
          const matches = conditionMatches || stanMatches;
          return matches;
        });
        console.log('Products after condition/stan filter:', filteredProducts.length);
      }

      // Apply search filter if exists
      const searchTerm = window.currentFilters?.search?.toLowerCase();
      if (searchTerm) {
        filteredProducts = filteredProducts.filter(product => {
          const searchableFields = [
            product.custom_symbol,
            product.custom_kod_producenta,
            product.custom_manufacturer,
            product.custom_srednica,
            product.custom_fi,
            product.custom_drill_length,
            product.vendor,
            product.title,
            product.sku
          ].filter(Boolean).map(field => field.toString().toLowerCase());

          return searchableFields.some(field => field.includes(searchTerm));
        });
      }
      console.log('Filtered products:', filteredProducts.length);
      // Apply category filter if not "wszystkie"
      if (window.selectedCategory && window.selectedCategory !== 'wszystkie') {
        console.log('Applying category filter:', window.selectedCategory);
        const categoryToType = {
          'koronkowe': 'VW',
          'plytkowe': 'PR',
          'vhm': 'WW',
          'sandvik': 'PS',
          'ksem': 'WK',
          'amec': 'WV',
          'iscar': 'IS',
          'walter': 'WA'
        };
        const expectedType = categoryToType[window.selectedCategory];
        filteredProducts = filteredProducts.filter(product => {
          const matches = expectedType && product.sku && product.sku.startsWith(expectedType);
          return matches;
        });
      }

      // Apply type filter
      if (window.WiertlaCNC.filters.type && window.WiertlaCNC.filters.type !== 'all') {
        console.log('Applying type filter:', window.WiertlaCNC.filters.type);
        const typeMapping = {
          'vhm': 'WW',
          'hss': 'HSS',
          'carbide': 'Węglik'
        };
        const expectedType = typeMapping[window.WiertlaCNC.filters.type];
        filteredProducts = filteredProducts.filter(product => {
          const matches = expectedType && product.custom_category && product.custom_category.includes(expectedType);
          return matches;
        });
      }

      // Apply status filter
      if (window.WiertlaCNC.filters.status && window.WiertlaCNC.filters.status !== 'all') {
        filteredProducts = filteredProducts.filter(product => {
          if (window.WiertlaCNC.filters.status === 'rentable') return product.rentable;
          if (window.WiertlaCNC.filters.status === 'non-rentable') return !product.rentable;
          return true;
        });
      }

      // Apply manufacturer filter
      if (window.WiertlaCNC.filters.manufacturer && window.WiertlaCNC.filters.manufacturer !== 'all') {
        const manufacturerMapping = {
          'sandvik': 'Sandvik',
          'iscar': 'ISCAR',
          'walter': 'WALTER',
          'ksem': 'KSEM',
          'amec': 'AMEC',
          'GÜHRING': 'GÜHRING',
          'wnt': 'WNT',
          'mikrontool': 'MIKRONTOOL',
          'taegutec': 'TaeguTec',
          'kennametal': 'KENNAMETAL',
        };
        const expectedManufacturer = manufacturerMapping[window.WiertlaCNC.filters.manufacturer];
        console.log(filteredProducts);
        filteredProducts = filteredProducts.filter(product => {
          const matches = expectedManufacturer && product.vendor && 
                 product.vendor.toLowerCase().includes(expectedManufacturer.toLowerCase());
          return matches;
        });
      }

      // Apply manufacturer filter if exists
      if (window.WiertlaCNC.filters.manufacturer && window.WiertlaCNC.filters.manufacturer !== 'all') {
        filteredProducts = filteredProducts.filter(product => {
          const manufacturerMatches = product.vendor && 
                 product.vendor.toLowerCase().includes(window.WiertlaCNC.filters.manufacturer.toLowerCase());
          return manufacturerMatches;
        });
      }

      // Sort all products by Fi (diameter) from lowest to highest
      filteredProducts.sort((a, b) => {
        // Extract Fi values and convert to numbers
        const getFiValue = (product) => {
          // Try to get fi value from different possible locations
          let fiValue = '';
          
          // First try custom_fi or custom_srednica
          if (product.custom_fi && product.custom_fi !== '-') {
            fiValue = product.custom_fi;
          } else if (product.custom_srednica && product.custom_srednica !== '-') {
            fiValue = product.custom_srednica;
          }
          
          // If no value found, try to extract from title
          if (!fiValue || fiValue === '-') {
            const titleMatch = product.title?.match(/(?:⌀|Fi)\s*(\d+[.,]?\d*)/i);
            if (titleMatch) {
              fiValue = titleMatch[1];
            }
          }
          
          // If still no value, try metafields
          if (!fiValue || fiValue === '-') {
            fiValue = product.metafields?.custom?.diameter?.value || '';
          }

          // If value is "-" or empty, return MAX_SAFE_INTEGER to move it to the end
          if (!fiValue || fiValue === '-') {
            return Number.MAX_SAFE_INTEGER;
          }

          // Extract numeric value, replacing commas with periods first
          const numericValue = parseFloat(String(fiValue).replace(/,/g, '.').replace(/[^\d.]/g, ''));
          // Return the numeric value or MAX_SAFE_INTEGER if not a valid number
          return isNaN(numericValue) ? Number.MAX_SAFE_INTEGER : numericValue;
        };
        
        const fiA = getFiValue(a);
        const fiB = getFiValue(b);
        
        // Sort ascending (lowest to highest)
        return fiA - fiB;
      });

      console.log('Final filtered and sorted products count:', filteredProducts.length);
      return filteredProducts;
    }
    
    // Update filter functions
       
    
    // Make filterProducts globally accessible
    window.filterProducts = filterProducts;
    
    // Add a temporary filter function that can be called from the console
    window.tempFilterByTitle = function(searchTerm) {
      // Store the original allProducts
      if (!window._originalProducts) {
        window._originalProducts = [...allProducts];
      }
      
      // Filter products by title
      allProducts = window._originalProducts.filter(product => {
        const title = (product.title || '').toLowerCase();
        return title.includes(searchTerm.toLowerCase());
      });
      
      // Apply filters to update the table
      applyFilters();
      
      // Log the number of filtered products
    };
    
    // Function to reset the temporary filter
    window.resetTempFilter = function() {
      if (window._originalProducts) {
        allProducts = [...window._originalProducts];
        applyFilters();
      }
    };
    
    // Apply filters and pagination
    function applyFilters() {
      // Get filtered products using filterProducts function
      const filteredProducts = filterProducts();
      
      // Update pagination
      window.totalPages = Math.ceil(filteredProducts.length / window.itemsPerPage);
      
      // Reset page if needed
      if (window.currentPage > window.totalPages) {
        window.currentPage = window.totalPages > 0 ? window.totalPages : 1;
      }
      
      // Calculate slice indexes for pagination
      const startIndex = (window.currentPage - 1) * window.itemsPerPage;
      const endIndex = startIndex + window.itemsPerPage;
      const productsToShow = filteredProducts.slice(startIndex, endIndex);
      
      // Generate table with filtered and paginated products
      generateTable(productsToShow);
      updatePaginationButtons();
      
      // Update results count
      const resultsCount = document.querySelector('.wiertla-categories__results-count');
      const resultsNumbers = document.querySelector('#resultsCount');
      
      if (resultsCount && resultsNumbers) {
        const startDisplay = filteredProducts.length > 0 ? startIndex + 1 : 0;
        const endDisplay = Math.min(endIndex, filteredProducts.length);
        const format = translations[currentLanguage].results_format;
        resultsNumbers.textContent = format.replace('{0}', startDisplay)
                                         .replace('{1}', endDisplay)
                                         .replace('{2}', filteredProducts.length);
      }
      
      // Synchronize active states for category icons
      document.querySelectorAll('.wiertla-categories__icon-item').forEach(item => {
        const itemCategory = item.dataset.category;
        if (itemCategory === window.selectedCategory) {
          item.classList.add('active');
        } else {
          item.classList.remove('active');
        }
      });
      
      // Synchronize active states for filter buttons
      document.querySelectorAll('.wiertla-categories__filter-button').forEach(btn => {
        const btnFilter = btn.getAttribute('data-filter');
        if (btnFilter === window.selectedCategory) {
          btn.classList.add('active');
        } else {
          btn.classList.remove('active');
        }
      });
      
      // Update fullscreen mode if active
      const fullscreenMode = document.querySelector('.wiertla-categories__fullscreen-mode');
      if (fullscreenMode && fullscreenMode.classList.contains('active')) {
        applyFullscreenFilters();
      }
      
      // Update URL parameters
      updateUrlParams();
    }
    
    // Make it globally available
    window.applyFilters = applyFilters;
    
    // Update pagination button states
    function updatePaginationButtons() {
      const prevButton = document.getElementById('prevPage');
      const nextButton = document.getElementById('nextPage');
      
      if (prevButton) {
        prevButton.disabled = window.currentPage <= 1;
      } else {
        console.error('Previous button not found');
      }
      
      if (nextButton) {
        nextButton.disabled = window.currentPage >= window.totalPages;
      } else {
        console.error('Next button not found');
      }
    }
    
    // Handle pagination button clicks
    const prevButton = document.getElementById('prevPage');
    const nextButton = document.getElementById('nextPage');
    
    if (prevButton) {
      prevButton.addEventListener('click', function() {
        if (window.currentPage > 1) {
          window.currentPage--;
          applyFilters();
        }
      });
    }
    
    if (nextButton) {
      nextButton.addEventListener('click', function() {
        if (window.currentPage < window.totalPages) {
          window.currentPage++;
          applyFilters();
        }
      });
    }
    
    // Handle search input
    if (searchInput) {
      searchInput.addEventListener('input', function() {
        window.currentFilters.search = this.value.trim();
        window.currentPage = 1;
        applyFilters();
      });
    }
    
    // Handle fullscreen button
    const fullscreenBtn = document.querySelector('.wiertla-categories__fullscreen-btn');
    const fullscreenMode = document.querySelector('.wiertla-categories__fullscreen-mode');
    const fullscreenClose = document.querySelector('.wiertla-categories__fullscreen-close');
    const fullscreenContent = document.querySelector('.wiertla-categories__fullscreen-content');
    
    if (fullscreenBtn && fullscreenMode && fullscreenContent) {
      fullscreenBtn.addEventListener('click', function() {
        // Add fullscreen header with proper translation elements
        const fullscreenHeader = document.createElement('div');
        fullscreenHeader.className = 'wiertla-categories__fullscreen-header';
        
        fullscreenHeader.innerHTML = `
          <div class="wiertla-categories__fullscreen-title">
            <h2>${translations[currentLanguage].fullscreen_title}</h2>
            <p>${translations[currentLanguage].fullscreen_description}</p>
          </div>
          <button class="wiertla-categories__fullscreen-close">
            <span>${translations[currentLanguage].close_fullscreen}</span>
            <img src="{{ 'zoom_out_map.svg' | asset_url }}" alt="Exit Fullscreen" width="24" height="24">
          </button>
        `;
        
        // Replace existing fullscreen content
        fullscreenMode.innerHTML = '';
        fullscreenMode.appendChild(fullscreenHeader);
        
        // Create container for the content
        const fullscreenContainer = document.createElement('div');
        fullscreenContainer.className = 'wiertla-categories__fullscreen-container';
        fullscreenMode.appendChild(fullscreenContainer);
    
        // Clone filters and table
        const filters = document.querySelector('.wiertla-categories__filters').cloneNode(true);
        const tableContainer = document.querySelector('.wiertla-categories__table-container').cloneNode(true);
        const resultsContainer = document.querySelector('.wiertla-categories__results').cloneNode(true);
    
        // Update IDs in cloned content to avoid duplicates
        const newTableBody = tableContainer.querySelector('#productsTableBody');
        if (newTableBody) {
          newTableBody.id = 'fullscreenProductsTableBody';
        }
    
        const newResultsCount = resultsContainer.querySelector('#resultsCount');
        if (newResultsCount) {
          newResultsCount.id = 'fullscreenResultsCount';
        }
    
        const newPrevButton = resultsContainer.querySelector('#prevPage');
        if (newPrevButton) {
          newPrevButton.id = 'fullscreenPrevPage';
          // Set translation text
          newPrevButton.setAttribute('data-text', translations[currentLanguage].show_previous);
        }
    
        const newNextButton = resultsContainer.querySelector('#nextPage');
        if (newNextButton) {
          newNextButton.id = 'fullscreenNextPage';
          // Set translation text
          newNextButton.setAttribute('data-text', translations[currentLanguage].show_next);
        }
    
        // Create fullscreen layout
        const fullscreenLayout = document.createElement('div');
        fullscreenLayout.className = 'wiertla-categories__fullscreen-layout';
    
        // Create left and right columns
        const leftColumn = document.createElement('div');
        leftColumn.className = 'wiertla-categories__fullscreen-left';
    
        const rightColumn = document.createElement('div');
        rightColumn.className = 'wiertla-categories__fullscreen-right';
    
        // Add preview component to left column
        leftColumn.innerHTML = `
          <h3 class="wiertla-categories__preview-title">${translations[currentLanguage].preview_title}</h3>
          <div class="wiertla-categories__preview-container">
            <div class="wiertla-categories__preview-image">
              <img src="{{ 'custom_icons.png' | asset_url }}" alt="Preview" class="wiertla-categories__preview-img">
            </div>
            <div class="wiertla-categories__preview-hover" style="display: none;">
              <img src="" alt="Preview" class="wiertla-categories__preview-hover-img">
            </div>
          </div>
          <p class="wiertla-categories__preview-text">${translations[currentLanguage].preview_instruction}</p>
        `;
    
        // Add filters and table to right column
        rightColumn.appendChild(filters);
        rightColumn.appendChild(tableContainer);
    
        // Assemble the layout
        fullscreenLayout.appendChild(leftColumn);
        fullscreenLayout.appendChild(rightColumn);
    
        // Clear and update fullscreen content
        fullscreenContainer.innerHTML = '';
        fullscreenContainer.appendChild(fullscreenLayout);
        fullscreenContainer.appendChild(resultsContainer);
    
        // Show fullscreen mode
        fullscreenMode.classList.add('active');
        document.body.style.overflow = 'hidden';
    
        // Re-apply filters to the cloned table
        applyFullscreenFilters();
    
        // Add event listeners to cloned elements
        addFullscreenEventListeners();
    
        // Add close button event listener
        const newCloseButton = fullscreenMode.querySelector('.wiertla-categories__fullscreen-close');
        if (newCloseButton) {
          newCloseButton.addEventListener('click', function() {
            fullscreenMode.classList.remove('active');
            document.body.style.overflow = '';
          });
        }
      });
    }
    
    function applyFullscreenFilters() {
      const filteredProducts = filterProducts();
      const startIndex = (window.currentPage - 1) * window.itemsPerPage;
      const endIndex = startIndex + window.itemsPerPage;
      const productsToShow = filteredProducts.slice(startIndex, endIndex);
      
      const tableBody = document.getElementById('fullscreenProductsTableBody');
      if (!tableBody) {
        console.error('Fullscreen table body element not found!');
        return;
      }
      
      tableBody.innerHTML = '';
      
      if (productsToShow.length === 0) {
        const noResultsRow = document.createElement('tr');
        noResultsRow.innerHTML = `<td colspan="7" style="text-align: center; padding: 20px;">${translations[currentLanguage].no_results}</td>`;
        tableBody.appendChild(noResultsRow);
        return;
      }
      
      productsToShow.forEach(product => {
        const row = document.createElement('tr');
        row.className = 'wiertla-categories__table-row';
        row.setAttribute('data-product-id', product.id);
        
        row.innerHTML = `
          <td class="wiertla-categories__table-cell wiertla-categories__table-cell--type">
            <img src="${product.typeIcon}" alt="${product.type}" class="wiertla-categories__type-icon">
          </td>
          <td class="wiertla-categories__table-cell wiertla-categories__table-cell--diameter">
            ${product.diameter || '-'}
          </td>
          <td class="wiertla-categories__table-cell wiertla-categories__table-cell--length">
            ${product.length || '-'}
          </td>
          <td class="wiertla-categories__table-cell wiertla-categories__table-cell--symbol">
            ${product.symbol || '-'}
          </td>
          <td class="wiertla-categories__table-cell wiertla-categories__table-cell--vendor" data-href="/products/${product.handle || ''}">
            ${product.vendor || product.custom_manufacturer || '-'}
          </td>
          <td class="wiertla-categories__table-cell wiertla-categories__table-cell--price">
            ${product.price ? `${product.price} zł` : '-'}
          </td>
          <td class="wiertla-categories__table-cell wiertla-categories__table-cell--name">
            ${product.name || '-'}
          </td>
        `;
        
        if (product.image) {
          row.setAttribute('data-image', product.large_image);
          
          // Using mouseover for fullscreen mode to avoid conflicts
          row.addEventListener('mouseover', function() {
            const image = this.getAttribute('data-image');
            const hoverElement = document.querySelector('.wiertla-categories__preview-hover');
            const hoverImage = document.querySelector('.wiertla-categories__preview-hover-img');
            
            if (hoverImage) {
              hoverImage.src = image;
              hoverElement.style.display = 'block';
            }
          });
          
          row.addEventListener('mouseout', function() {
            const hoverElement = document.querySelector('.wiertla-categories__preview-hover');
            if (hoverElement) {
              hoverElement.style.display = 'none';
            }
          });
        }
        
        row.addEventListener('click', function(e) {
          if (e.target.tagName !== 'A' && e.target.tagName !== 'IMG') {
            const link = this.querySelector('.wiertla-categories__product-link');
            if (link) {
              window.location.href = link.getAttribute('href');
            }
          }
        });
        
        tableBody.appendChild(row);
      });
      
      // Update result count in fullscreen mode
      const resultsCount = document.getElementById('fullscreenResultsCount');
      if (resultsCount) {
        const startIndex = (window.currentPage - 1) * window.itemsPerPage + 1;
        const endIndex = Math.min(startIndex + productsToShow.length - 1, filteredProducts.length);
        const format = translations[currentLanguage].results_format;
        resultsCount.textContent = format.replace('{0}', startIndex).replace('{1}', endIndex).replace('{2}', filteredProducts.length);
      }
      
      // Update pagination buttons
      const prevButton = document.getElementById('fullscreenPrevPage');
      const nextButton = document.getElementById('fullscreenNextPage');
      
      if (prevButton) {
        prevButton.disabled = window.currentPage <= 1;
      }
      
      if (nextButton) {
        nextButton.disabled = window.currentPage >= window.totalPages;
      }
      
      // Synchronize active states for category icons in fullscreen view
      document.querySelectorAll('.wiertla-categories__fullscreen-content .wiertla-categories__icon-item').forEach(item => {
        const itemCategory = item.dataset.category;
        if (itemCategory === window.selectedCategory) {
          item.classList.add('active');
        } else {
          item.classList.remove('active');
        }
      });
      
      // Synchronize active states for filter buttons in fullscreen view
      document.querySelectorAll('.wiertla-categories__fullscreen-content .wiertla-categories__filter-button').forEach(btn => {
        const btnFilter = btn.getAttribute('data-filter');
        if (btnFilter === window.selectedCategory) {
          btn.classList.add('active');
        } else {
          btn.classList.remove('active');
        }
      });
    }
    
    function addFullscreenEventListeners() {
      // Handle fullscreen pagination
      const prevButton = document.getElementById('fullscreenPrevPage');
      const nextButton = document.getElementById('fullscreenNextPage');
      
      if (prevButton) {
        prevButton.addEventListener('click', function() {
          if (window.currentPage > 1) {
            window.currentPage--;
            applyFilters(); // Update main view
            applyFullscreenFilters(); // Update fullscreen view
          }
        });
      }
      
      if (nextButton) {
        nextButton.addEventListener('click', function() {
          if (window.currentPage < window.totalPages) {
            window.currentPage++;
            applyFilters(); // Update main view
            applyFullscreenFilters(); // Update fullscreen view
          }
        });
      }
      
      // Handle fullscreen filters
      const filterSelects = document.querySelectorAll('.wiertla-categories__fullscreen-content .wiertla-categories__filter');
      
      filterSelects.forEach(select => {
        select.addEventListener('change', function() {
          const filterType = this.getAttribute('data-filter');
          currentFilters[filterType] = this.value;
          window.currentPage = 1;
          applyFilters(); // Update main view
          applyFullscreenFilters(); // Update fullscreen view
        });
      });
      
      // Handle fullscreen per-page buttons
      const perPageButtons = document.querySelectorAll('.wiertla-categories__fullscreen-content .wiertla-categories__per-page-button');
      perPageButtons.forEach(button => {
        button.addEventListener('click', function() {
          const value = parseInt(this.getAttribute('data-value'));
          
          // Update active button
          perPageButtons.forEach(btn => btn.classList.remove('active'));
          this.classList.add('active');
          
          // Update items per page
          window.itemsPerPage = value;
          window.currentPage = 1;
          
          applyFilters(); // Update main view
          applyFullscreenFilters(); // Update fullscreen view
        });
      });
      
      // Handle fullscreen filter buttons
      const filterButtons = document.querySelectorAll('.wiertla-categories__fullscreen-content .wiertla-categories__filter-button');
      filterButtons.forEach(button => {
        button.addEventListener('click', function() {
          const filterType = this.getAttribute('data-filter');
          
          // Update active button
          filterButtons.forEach(btn => btn.classList.remove('active'));
          this.classList.add('active');
          
          // Update selected category
          window.selectedCategory = filterType;
          window.currentPage = 1;
          
          // If "Wszystkie" is clicked, reset all filters
          if (filterType === 'wszystkie') {
            currentFilters = {
              type: '',
              crown: '',
              manufacturer: '',
              search: ''
            };
            
            // Reset filter dropdowns in fullscreen view
            document.querySelectorAll('.wiertla-categories__fullscreen-content .wiertla-categories__filter').forEach(filter => {
              filter.value = '';
            });
            
            // Reset filter dropdowns in main view as well
            document.querySelectorAll('.wiertla-categories__filters .wiertla-categories__filter').forEach(filter => {
              filter.value = '';
            });
            
            // Clear search input
            const searchInput = document.querySelector('.wiertla-search__input');
            if (searchInput) {
              searchInput.value = '';
            }
          }
          
          applyFilters(); // Update main view
          applyFullscreenFilters(); // Update fullscreen view
        });
      });
      
      // Handle fullscreen icon items
      const iconItems = document.querySelectorAll('.wiertla-categories__fullscreen-content .wiertla-categories__icon-item');
      iconItems.forEach(item => {
        item.addEventListener('click', function() {
          // Remove active class from all icons in fullscreen view
          iconItems.forEach(icon => icon.classList.remove('active'));
          
          // Add active class to clicked icon
          this.classList.add('active');
          
          // Get category from data attribute
          const category = this.dataset.category || 'wszystkie';
          
          // Update selected category
          window.selectedCategory = category;
          window.currentPage = 1;
          // If "Wszystkie" is clicked, reset all filters
          if (category === 'wszystkie') {
            currentFilters = {
              type: '',
              crown: '',
              manufacturer: '',
              search: ''
            };
            
            // Reset filter dropdowns in fullscreen view
            document.querySelectorAll('.wiertla-categories__fullscreen-content .wiertla-categories__filter').forEach(filter => {
              filter.value = '';
            });
            
            // Reset filter dropdowns in main view as well
            document.querySelectorAll('.wiertla-categories__filters .wiertla-categories__filter').forEach(filter => {
              filter.value = '';
            });
            
            // Reset filter buttons in fullscreen view
            document.querySelectorAll('.wiertla-categories__fullscreen-content .wiertla-categories__filter-button').forEach(btn => {
              btn.classList.remove('active');
              if (btn.getAttribute('data-filter') === 'wszystkie') {
                btn.classList.add('active');
              }
            });
            
            // Reset filter buttons in main view
            document.querySelectorAll('.wiertla-categories__filters .wiertla-categories__filter-button').forEach(btn => {
              btn.classList.remove('active');
              if (btn.getAttribute('data-filter') === 'wszystkie') {
                btn.classList.add('active');
              }
            });
            
            // Clear search input
            const searchInput = document.querySelector('.wiertla-search__input');
            if (searchInput) {
              searchInput.value = '';
            }
          }
          
          applyFilters(); // Update main view
          applyFullscreenFilters(); // Update fullscreen view
        });
      });
    }
    
    // Add event delegation for filter icons
    document.addEventListener('click', function(event) {
      const iconItem = event.target.closest('.wiertla-categories__icon-item');
      if (iconItem) {
        // Remove active class from all icons in both icon containers
        document.querySelectorAll('.wiertla-categories__icon-item').forEach(item => {
          item.classList.remove('active');
        });
        
        // Add active class to clicked icon
        iconItem.classList.add('active');
        
        const category = iconItem.dataset.category || 'wszystkie';
        
        // If the clicked item is "Wszystkie", reset all filters except pagination
        if (category === 'wszystkie' || !category) {
          currentFilters = {
            type: '',
            crown: '',
            manufacturer: '',
            search: ''
          };
          
          // Reset filter dropdowns
          document.querySelectorAll('.wiertla-categories__filter').forEach(filter => {
            filter.value = '';
          });
          
          // Reset filter buttons
          document.querySelectorAll('.wiertla-categories__filter-button').forEach(btn => {
            btn.classList.remove('active');
          });
          
          // Set "Wszystkie" button to active
          const wszystkieBtn = document.querySelector('.wiertla-categories__filter-button[data-filter="wszystkie"]');
          if (wszystkieBtn) {
            wszystkieBtn.classList.add('active');
          }
          
          // Clear search input
          const searchInput = document.querySelector('.wiertla-search__input');
          if (searchInput) {
            searchInput.value = '';
          }
        } else {
          // Set the appropriate filter based on the category
          currentFilters.type = category;
        }
        
        // Update selected category and apply filters
        window.selectedCategory = category;
        window.currentPage = 1;
        applyFilters();
    
      }
    });
    
    // Add event delegation for filter buttons and dropdowns
    document.addEventListener('click', function(event) {
      const filterButton = event.target.closest('.wiertla-categories__filter-button');
      if (filterButton) {
        const allFilterButtons = document.querySelectorAll('.wiertla-categories__filter-button');
        allFilterButtons.forEach(btn => btn.classList.remove('active'));
        filterButton.classList.add('active');
        
        window.selectedCategory = filterButton.getAttribute('data-filter');
        window.currentPage = 1;
        
        // If clicking on "Wszystkie" button, reset all filters
        if (window.selectedCategory === 'wszystkie') {
          // Reset filter state
          currentFilters = {
            type: '',
            crown: '',
            manufacturer: '',
            search: ''
          };
          
          // Reset all dropdown filters to default values
          document.querySelectorAll('.wiertla-categories__filter').forEach(filter => {
            filter.value = '';
          });
          
          // Clear search input
          const searchInput = document.querySelector('.wiertla-search__input');
          if (searchInput) {
            searchInput.value = '';
          }
        }
        
        applyFilters();
      }
      
      const perPageButton = event.target.closest('.wiertla-categories__per-page-button');
      if (perPageButton) {
        const allPerPageButtons = document.querySelectorAll('.wiertla-categories__per-page-button');
        allPerPageButtons.forEach(btn => btn.classList.remove('active'));
        perPageButton.classList.add('active');
        
        window.itemsPerPage = parseInt(perPageButton.getAttribute('data-value'));
        window.currentPage = 1;
        applyFilters();
      }
    });
    
    // Add change event listeners for all filter dropdowns
    document.addEventListener('change', function(event) {
      const filterSelect = event.target.closest('.wiertla-categories__filter');
      if (filterSelect) {
        const filterType = filterSelect.getAttribute('data-filter');
        if (filterType) {
          // Only update if the value has actually changed
          if (currentFilters[filterType] !== filterSelect.value && filterSelect.value !== '') {
            currentFilters[filterType] = filterSelect.value;
            window.currentPage = 1;
            
            // Remove active class from "Wszystkie" button when a filter is selected
            const wszystkieBtn = document.querySelector('.wiertla-categories__filter-button[data-filter="wszystkie"]');
            if (wszystkieBtn) {
              wszystkieBtn.classList.remove('active');
            }
            
            applyFilters();
          }
        }
      }
    });
    
    // Add dummy product data if none exists
    if (allProducts.length === 0) {
      allProducts = [
        {
          id: 1,
          title: "Example Drill Bit",
          url: "#",
          type: "VW",
          vendor: "Sandvik",
          price: "120,00 zł",
          available: true,
          fi: "12",
          length: "85",
          symbol: "VW-12-85",
          rentable: true,
          image: "{{ 'placeholder.png' | asset_url }}",
          large_image: "{{ 'placeholder.png' | asset_url }}"
        },
        {
          id: 2,
          title: "Płytkowy Wiertło",
          url: "#",
          type: "PR",
          vendor: "Komet",
          price: "145,50 zł",
          available: true,
          fi: "8",
          length: "65",
          symbol: "PR-8-65",
          rentable: false,
          image: "{{ 'placeholder.png' | asset_url }}",
          large_image: "{{ 'placeholder.png' | asset_url }}"
        }
      ];
    }
    
    // Move the preview container creation up, before calling applyFilters
    // Create a separate preview container that shows on row hover
    const previewContainer = document.querySelector('.wiertla-categories__preview-image img');
    if (previewContainer) {
      // Set default image
      previewContainer.src = "{{ 'custom_icons.png' | asset_url }}";
      
      // Create a separate preview container that shows on row hover
      const tablePreviewContainer = document.createElement('div');
      tablePreviewContainer.className = 'wiertla-categories__table-preview desktop';
      tablePreviewContainer.innerHTML = `
        <div class="wiertla-categories__preview-image">
          <img src="{{ 'custom_icons.png' | asset_url }}" alt="Preview" class="wiertla-categories__preview-img">
        </div>
      `;
      
      // Append to the left column, after the main preview
      const leftColumn = document.querySelector('.wiertla-categories__left-column');
      if (leftColumn) {
        leftColumn.appendChild(tablePreviewContainer);
      }
    }
    
    // Initial table population
    applyFilters();
    
    // Set "Wszystkie" icon as active by default in both icon containers
    document.querySelectorAll('.wiertla-categories__icon-item').forEach((item, index, array) => {
      // Add active class to last icon in icon set (Wszystkie) or one with data-category="wszystkie"
      const isWszystkie = item.querySelector('.wiertla-categories__icon-label')?.textContent.trim().toUpperCase() === 'WSZYSTKIE' ||
                         item.dataset.category === 'wszystkie';
      
      if (isWszystkie || (index === array.length - 1 && array.length > 0)) {
        item.classList.add('active');
      } else {
        item.classList.remove('active');
      }
    });
    
    // Also set the "Wszystkie" filter button to active
    const wszystkieBtn = document.querySelector('.wiertla-categories__filter-button[data-filter="wszystkie"]');
    if (wszystkieBtn) {
      wszystkieBtn.classList.add('active');
    }
    
    // Initialize UI with current language
    updateUILanguage();
    
    // Set active language button
    document.querySelectorAll('.wiertla-categories__language-btn').forEach(btn => {
      if (btn.getAttribute('data-lang') === currentLanguage) {
        btn.classList.add('active');
      }
    });
    
    // Connect header language switcher to our translation system
    document.addEventListener('DOMContentLoaded', function() {
      // Add event listeners to header language links
      document.querySelectorAll('.header__lang-links a').forEach(link => {
        link.addEventListener('click', function(e) {
          e.preventDefault();
          const lang = this.getAttribute('data-lang');
          if (lang && translations[lang]) {
            window.changeLanguage(lang);
            
            // Update active state in the header language links
            document.querySelectorAll('.header__lang-links a').forEach(l => {
              if (l.getAttribute('data-lang') === lang) {
                l.classList.add('active');
              } else {
                l.classList.remove('active');
              }
            });
          }
        });
      });
      
      // Set initial active state for the header language links
      document.querySelectorAll('.header__lang-links a').forEach(link => {
        if (link.getAttribute('data-lang') === currentLanguage) {
          link.classList.add('active');
        } else {
          link.classList.remove('active');
        }
      });
    });
    
    // Watch for language changes in the header
    document.addEventListener('click', function(e) {
      // Look for header language links
      const langLink = e.target.closest('.header__lang-links a');
      if (langLink) {
        e.preventDefault(); // Prevent default to avoid page reload
        const lang = langLink.getAttribute('data-lang');
        if (lang && translations[lang]) {
          window.changeLanguage(lang);
          
          // Update active state in the header language links
          document.querySelectorAll('.header__lang-links a').forEach(l => {
            if (l.getAttribute('data-lang') === lang) {
              l.classList.add('active');
            } else {
              l.classList.remove('active');
            }
          });
        }
      }
    });
    
    // After DOM is fully loaded, force a redraw based on current size
    document.addEventListener('DOMContentLoaded', function() {
      const currentIsMobileView = window.innerWidth <= 768;
      // Update global isMobileView
      isMobileView = currentIsMobileView;
      
      // Force a redraw after DOM is fully loaded
      setTimeout(function() {
        applyFilters();
      }, 100);
    });
    
    // Add ONE resize handler
    let resizeTimeout;
    window.addEventListener('resize', function() {
      clearTimeout(resizeTimeout);
      resizeTimeout = setTimeout(function() {
        // Use the same approach as in generateTable
        const currentIsMobileView = window.innerWidth <= 768;
        if (currentIsMobileView !== isMobileView) {
          isMobileView = currentIsMobileView;
          applyFilters(); // This will regenerate the table with the correct view
        }
      }, 250);
    });
    
    // Define the missing showProductImage and hideProductImage functions
    function showProductImage(row) {
      const image = row.getAttribute('data-image');
      if (!image) return;
      
      // Update both hover previews
      const hoverPreview = document.querySelector('.wiertla-categories__hover-preview');
      if (hoverPreview) {
        const imageElement = hoverPreview.querySelector('img');
        if (imageElement) {
          imageElement.src = image;
          hoverPreview.classList.add('active');
          hoverPreview.style.display = 'block';
        }
      }
      
      const newImageHover = document.querySelector('.wiertla-categories__image-hover');
      if (newImageHover) {
        const imageElement = newImageHover.querySelector('img');
        if (imageElement) {
          imageElement.src = image;
          newImageHover.classList.add('active');
          newImageHover.style.display = 'block';
        }
      }
      
      // Also update preview area in layout
      const previewContainer = document.querySelector('.wiertla-categories__preview-image img');
      if (previewContainer) {
        previewContainer.src = image;
      }
    }
    function formatSymbol(symbol) {
      if (!symbol || symbol === '-') return '-';
      
      // Maximum length for symbols before truncation
      const maxLength = 13;
      
      // If symbol is longer than max length, truncate and add ellipsis
      if (symbol.length > maxLength) {
        return symbol.substring(0, maxLength) + '...';
      }
      
      return symbol;
    }
    function hideProductImage() {
      // Hide both hover previews
      const hoverPreview = document.querySelector('.wiertla-categories__hover-preview');
      if (hoverPreview) {
        hoverPreview.classList.remove('active');
        hoverPreview.style.display = 'none';
      }
      
      const newImageHover = document.querySelector('.wiertla-categories__image-hover');
      if (newImageHover) {
        newImageHover.classList.remove('active');
        newImageHover.style.display = 'none';
      }
      
      // Reset preview back to default
      const previewContainer = document.querySelector('.wiertla-categories__preview-image img');
      if (previewContainer) {
        previewContainer.src = "{{ 'custom_icons.png' | asset_url }}";
      }
    }
    
    // Only have ONE generateTable function
    function generateTable(products) {
      const tableBody = document.querySelector('.wiertla-categories__table tbody');
      if (!tableBody) {
        console.error('Table body element not found');
        return;
      }

      // Clear existing table content
      tableBody.innerHTML = '';

      // Check if products array is valid
      if (!Array.isArray(products) || products.length === 0) {
        const noResultsRow = document.createElement('tr');
        noResultsRow.innerHTML = `
          <td colspan="7" class="wiertla-categories__table-cell" style="text-align: center; padding: 20px;">
            ${translations[currentLanguage].no_results || 'Brak wyników'}
          </td>
        `;
        tableBody.appendChild(noResultsRow);
        return;
      }

      // Products are already sorted by diameter (FI) in the filterProducts function
     
      // Create preview container if it doesn't exist
      let previewContainer = document.querySelector('.wiertla-categories__preview-container');
      if (!previewContainer) {
        previewContainer = document.createElement('div');
        previewContainer.className = 'wiertla-categories__preview-container';
        previewContainer.style.cssText = `
          position: fixed;
          left: 0;
          top: 0;
          width: 300px;
          height: 100vh;
          background: white;
          z-index: 1000;
          padding: 20px;
          display: none;
          box-shadow: 2px 0 5px rgba(0,0,0,0.1);
        `;
        previewContainer.innerHTML = `
          <div style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center;">
            <img src="" alt="" style="max-width: 100%; max-height: 100%; object-fit: contain;">
          </div>
        `;
        document.body.appendChild(previewContainer);
      }

      // Generate table rows using the provided products
      products.forEach((product, index) => {
        if (!product) {
          console.warn('Invalid product data at index:', index);
          return;
        }

        const row = document.createElement('tr');
        row.className = 'wiertla-categories__table-row';
        row.setAttribute('data-product-id', product.id || '');
        row.setAttribute('data-href', product.url || '');

        // Set image data if available
        if (product.image) {
          row.setAttribute('data-image', product.image);
          
          // Add mouseover handler for image preview
          row.addEventListener('mouseenter', function() {
            const imageUrl = this.getAttribute('data-image');
            if (imageUrl) {
              const previewImage = previewContainer.querySelector('img');
              if (previewImage) {
                previewImage.src = imageUrl;
                previewImage.alt = product.title || '';
                previewContainer.style.display = 'block';
              }
            }
          });
          
          // Add mouseout handler to hide preview
          row.addEventListener('mouseleave', function() {
            previewContainer.style.display = 'none';
          });
        }

        // Define icon mapping
        const iconMap = {
          'VW': "{{ 'image-8.png' | asset_url }}",
          'PR': "{{ 'image-10.png' | asset_url }}",
          'WW': "{{ 'image-12.png' | asset_url }}",
          'PS': "{{ 'image-9.png' | asset_url }}",
          'WK': "{{ 'image-13.png' | asset_url }}",
          'WV': "{{ 'image-11.png' | asset_url }}",
          'IS': "{{ 'image-14.png' | asset_url }}",
          'WA': "{{ 'image-15.png' | asset_url }}"
        };

        // Get SKU prefix for icon
        const skuPrefix = product.sku?.substring(0, 2) || '';
        const iconUrl = iconMap[skuPrefix] || product.image || '';
        // Generate row content based on screen width
        if (window.innerWidth <= 768) {
          row.innerHTML = `
            <td class="wiertla-categories__table-cell">
              <button type="button" class="wiertla-categories__mobile-card" data-product-id="${product.id || ''}" data-product-url="${product.url || ''}">
                <div class="wiertla-categories__mobile-top">
                  <div class="wiertla-categories__mobile-image">
                    ${iconUrl ? `<img src="${iconUrl}" alt="${product.type || 'Product'}" width="34" height="34" loading="lazy">` : '-'}
                  </div>
                  <div class="wiertla-categories__mobile-fi">
                    <span class="mobile-label">Fi ⌀</span>
                    <span class="mobile-value">${product.custom_fi || product.custom_srednica || '-'}</span>
                  </div>
                  <div class="wiertla-categories__mobile-dimension">
                    ${product.metafields.custom.custom_working_length || product.custom_working_length || product.custom_xd || '-'}
                    
                  </div>
                </div>
                <div class="wiertla-categories__mobile-bottom">
                  <div class="wiertla-categories__mobile-vendor">
                                ${formatSymbol(product.vendor || product.custom_manufacturer || '-')}

                  </div>
                  <div class="wiertla-categories__mobile-symbol">
                                ${formatSymbol(product.custom_symbol || product.custom_kod_producenta || '-')}
                  </div>
                  <div class="wiertla-categories__mobile-price-wrapper">
                    <div class="wiertla-categories__mobile-price">
                      ${product.price}
                    </div>
                    ${product.custom_rent ? `
                      <button class="wiertla-categories__mobile-rent-button" data-product-id="${product.id}">
                        <span>RENT A TOOL</span>
                      </button>
                    ` : ''}
                  </div>
                </div>
              </button>
            </td>
          `;
          const mobileCard = row.querySelector('.wiertla-categories__mobile-card');
          if (mobileCard) {
            mobileCard.addEventListener('click', function(e) {
              e.preventDefault();
              e.stopPropagation();
              
              const previewModal = document.querySelector('.wiertla-categories__mobile-preview-modal');
              if (!previewModal) return;
              
              const modalImage = previewModal.querySelector('.wiertla-categories__preview-modal-image');
              if (modalImage) {
                modalImage.src = product.image;
                modalImage.alt = product.title;
              }
              
              previewModal.addEventListener('click', function(event) {
                if (event.target === previewModal) {
                  previewModal.classList.remove('active');
                  setTimeout(() => {
                    previewModal.style.display = 'none';
                    document.body.style.overflow = '';
                  }, 300);
                }
              });
              
              previewModal.style.display = 'block';
              document.body.style.overflow = 'hidden';
              
              setTimeout(() => {
                previewModal.classList.add('active');
              }, 10);
            });
          }
        } else {
          row.innerHTML = `
            <td class="wiertla-categories__table-cell" data-href="/products/${product.handle || ''}">
              ${iconUrl ? `<img src="${iconUrl}" alt="${product.type || 'Product'}" width="34" height="34" loading="lazy">` : '-'}
            </td>
            <td class="wiertla-categories__table-cell" data-href="/products/${product.handle || ''}">
              ${product.custom_fi ? '⌀ ' + product.custom_fi || product.custom_srednica : '-'}
            </td>
            <td class="wiertla-categories__table-cell" data-href="/products/${product.handle || ''}">
                    ${product.metafields.custom.custom_working_length || product.custom_working_length || product.custom_xd || '-'}
            </td>
            <td class="wiertla-categories__table-cell" data-href="/products/${product.handle || ''}">
                                ${formatSymbol(product.custom_symbol  || product.custom_kod_producenta || '-')}
            </td>
            <td class="wiertla-categories__table-cell" data-href="/products/${product.handle || ''}">
                                ${formatSymbol(product.vendor || product.custom_manufacturer || '-')}
            </td>
             <td class="wiertla-categories__table-cell">
              <div class="wiertla-categories__price-wrapper">
                <span class="wiertla-categories__price" data-href="/products/${product.handle}">${product.price}</span>
                ${product.custom_rent ? `
                  <button class="wiertla-categories__rent-button" data-product-id="${product.id}">
                    <span>RENT A TOOL</span>
                  </button>
                ` : ''}
              </div>
            </td>
          `;
        }

        // Add click handlers for table cells
        const cells = row.querySelectorAll('.wiertla-categories__table-cell[data-href]');
        cells.forEach(cell => {
          cell.addEventListener('click', function(e) {
            if (!e.target.closest('.wiertla-categories__rent-button')) {
              const url = this.getAttribute('data-href');
              if (url) {
                window.location.href = url;
              }
            }
          });
        });

        // Add click handler for rent button
        const rentButton = row.querySelector('.wiertla-categories__rent-button');
        if (rentButton) {
          rentButton.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            const productId = this.getAttribute('data-product-id');
            
            if (window.WiertlaCNC && window.WiertlaCNC.products) {
              const product = window.WiertlaCNC.products.find(p => p.id === Number(productId));
              if (product) {
                window.WiertlaCNC.openRentModal(product);
              }
            }
          });
        }

        tableBody.appendChild(row);
      });

      // Update results count
      const resultsCount = document.getElementById('resultsCount');
      if (resultsCount) {
        const startIndex = (window.currentPage - 1) * window.itemsPerPage + 1;
        const endIndex = Math.min(startIndex + products.length - 1, allProducts.length);
        const format = translations[currentLanguage].results_format;
        resultsCount.textContent = format.replace('{0}', startIndex).replace('{1}', endIndex).replace('{2}', allProducts.length);
      }
    }
    
      });
    
      
      // Make the openFilterModal function globally available
      window.openFilterModal = function() {
    const modal = document.querySelector('.wiertla-categories__mobile-filter-modal');
    if (modal) {
      // Force all style properties directly
      modal.style.display = "block";
      modal.style.visibility = "visible";
      modal.style.opacity = "1";
      modal.style.pointerEvents = "auto";
      modal.classList.add("active");
      document.body.style.overflow = "hidden";
    } else {
      console.error("Modal not found in global function");
    }
    return false;
      };
      
      // Close modal function
      window.closeFilterModal = function() {
    const modal = document.querySelector('.wiertla-categories__mobile-filter-modal');
    if (modal) {
      modal.style.display = "none";
      modal.style.visibility = "hidden";
      modal.style.opacity = "0";
      modal.style.pointerEvents = "none";
      modal.classList.remove("active");
      document.body.style.overflow = "";
    }
      };
      
      // Wait for full DOM loading
      document.addEventListener('DOMContentLoaded', function() {
    
    // Direct targeting of the filter button by ID
    const filterButtonTrigger = document.getElementById('mobile-filter-button-trigger');
    
    const mobileFilterModal = document.querySelector('.wiertla-categories__mobile-filter-modal');
    
    // Direct click handler for the ID-based button
    if (filterButtonTrigger) {
      filterButtonTrigger.addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        
        window.openFilterModal();
      });
    }
    
    // Also check all buttons with class
    const filterButtons = document.querySelectorAll('.wiertla-categories__mobile-filter-button');
    
    filterButtons.forEach(function(btn, index) {
      btn.addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        
        window.openFilterModal();
      });
    });
    
    // Close buttons
    const closeButtons = document.querySelectorAll('.wiertla-categories__mobile-filter-close, .wiertla-categories__mobile-filter-close-wrapper');
    closeButtons.forEach(function(btn) {
      btn.addEventListener('click', function() {
        window.closeFilterModal();
      });
    });
    
    // Close when clicking outside
    if (mobileFilterModal) {
      mobileFilterModal.addEventListener('click', function(e) {
        if (e.target === mobileFilterModal) {
          window.closeFilterModal();
        }
      });
    }
      });
    
      document.addEventListener('DOMContentLoaded', function() {
    // Add click handlers for mobile categories
    const mobileTypeItems = document.querySelectorAll('.wiertla-categories-mobile-types__item');
    
    mobileTypeItems.forEach(item => {
      item.addEventListener('click', function() {
        const category = this.getAttribute('data-category');
        
        // Set active class
        mobileTypeItems.forEach(el => el.classList.remove('active'));
        this.classList.add('active');
        
        // Call the global filter function
        if (typeof window.handleCategoryChange === 'function') {
          window.handleCategoryChange(category);
        }
      });
    });
      });
  </script>

  {% style %}
    .wiertla-categories {
      width: 100%;
      max-width: 100%;
      margin: 0 auto;
      padding: 0;
      font-family: 'Montserrat'
      , sans-serif;
    }

    .wiertla-categories__container {
      max-width: 1440px;
      margin: 0 auto;
      padding: 0 24px;
    }
    @media screen and (max-width: 1024px) {
      .wiertla-categories__container {
        padding: 0;
      }
    }

    /* Language Switcher */
    .wiertla-categories__language-switcher {
      display: flex;
      gap: 5px;
      margin-left: 15px;
    }

    .wiertla-categories__language-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 30px;
      height: 30px;
      border-radius: 15px;
      border: 1px solid #E2E2E7;
      background: white;
      font-family: 'Montserrat'
      , sans-serif;
      font-weight: 600;
      font-size: 12px;
      color: #112832;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .wiertla-categories__language-btn:hover {
      background: #F5F5F8;
    }

    .wiertla-categories__language-btn.active {
      background: #112832;
      color: white;
      border-color: #112832;
    }

    /* Icons */
    .wiertla-categories__icons {
      display: flex;
      gap: 10px;
    }

    .wiertla-categories__icon-button {
      width: 40px;
      height: 40px;
      border: 1px solid #E2E2E7;
      border-radius: 20px;
      background: transparent;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .wiertla-categories__icon-button.active {
      background: #112832;
      border-color: #112832;
    }

    .wiertla-categories__icon-button.active svg {
      fill: white;
    }

    .wiertla-categories__icon {
      object-fit: cover;
    }

    .wiertla-categories__icon-label {
      font-family: 'League Spartan'
      , sans-serif;
      font-weight: 700;
      font-size: 18px;
      line-height: 100%;
      letter-spacing: 0.06em;
      color: #112832;
      text-align: center;
      text-transform: uppercase;
      text-decoration: none;
    }

    /* Mobile Icons */
    .wiertla-categories__mobile-icons {
      display: none;
    }

    @media (max-width: 768px) {
      .wiertla-categories__mobile-icons {
        display: flex;
        justify-content: space-between;
        gap: 10px;
        overflow-x: auto;
        margin-bottom: 20px;
        padding-bottom: 10px;
      }
      .wiertla-categories__container .wiertla-categories__icons {
        display: grid;
        grid-template-columns: 1fr 1fr;
      }
      .wiertla-categories__icons .wiertla-categories__icon-item {
        height: auto;
        width: 100%;
      }
      .wiertla-categories__mobile-nav .wiertla-categories__scroll-container .wiertla-categories__icons {
        display: none !important;
      }
    }

    /* Tabs */
    .wiertla-categories__tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 0;
      overflow-x: auto;
    }

    .wiertla-categories__tab {
      padding: 10px 20px;
      background: white;
      border: 2px solid #E2E2E7;
      border-radius: 0;
      font-family: 'Montserrat'
      , sans-serif;
      font-weight: 600;
      font-size: 12px;
      line-height: 14px;
      color: #112832;
      cursor: pointer;
      transition: all 0.3s ease;
      white-space: nowrap;
      border-bottom: none;
    }

    .wiertla-categories__tab.active {
      background: #F5F5F8;
      color: #5D7077;
      border-color: #E2E2E7;
    }

    /* Status Filters */
    .wiertla-categories__status-filters {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }

    .wiertla-categories__status-filter {
      padding: 8px 16px;
      border: 1px solid #E2E2E7;
      border-radius: 20px;
      background: transparent;
      font-family: "League Spartan"
      , sans-serif;
      font-weight: 700;
      font-size: 18px;
      line-height: 16.6px;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      color: #112832;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .wiertla-categories__status-filter.active {
      border: 2px solid #112832;
    }

    /* Layout styles for the two-column structure */
    .wiertla-categories__layout {
      display: flex;
      flex-wrap: wrap;
      gap: 40px;
      margin-top: 40px;
    }

    .wiertla-categories__left-column {
      width: 425px;
      flex-shrink: 0;
    }

    .wiertla-categories__right-column {
      flex: 1;
      min-width: 0;
    }

    /* Content and mobile layout styles */
    .wiertla-categories__content {
      position: relative;
    }

    /* Hide mobile elements on desktop */
    .wiertla-categories__mobile-icons,
    .wiertla-categories__mobile-nav,
    .wiertla-categories__mobile-controls,
    .wiertla-categories__mobile-filter-modal,
    .wiertla-categories__mobile-rent-modal,
    .wiertla-categories__scroll-container,
    .wiertla-categories__scroll-indicator,
    .wiertla-categories__mobile-filter-btn,
    .wiertla-categories__mobile-sort-btn,
    .wiertla-categories__mobile-per-page {
      display: none !important;
    }

    .wiertla-categories__tabs {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }
    @media screen and (max-width: 768px) {
      .wiertla-categories__tabs {
        display: flex;
        flex-direction: row;
        flex-wrap: nowrap;
        gap: 15px;
      }
    }
    .wiertla-categories__tab {
      padding: 10px 20px;
      border: 2px solid #E2E2E7;
      font-family: 'League Spartan'
      , sans-serif;
      font-weight: 700;
      font-size: 16px;
      line-height: 16px;
      letter-spacing: 0.06em;
      color: #112832;
      cursor: pointer;
      transition: all 0.3s ease;
      border-bottom: none;
    }


    .wiertla-categories__status-filters {
      display: flex;
      gap: 10px;
      margin-bottom: 30px;
    }

    .wiertla-categories__status-filter {
      padding: 5px 15px;
      background: transparent;
      border: 2px solid #E2E2E7;
      font-family: 'Montserrat'
      , sans-serif;
      font-weight: 500;
      font-size: 14px;
      line-height: 14px;
      color: #112832;
      cursor: pointer;
      transition: all 0.3s ease;
    }


    /* Table Styles - fixed row height without truncating content */
    .wiertla-categories__table {
      border-collapse: separate;
      border-spacing: 0;
      width: 100%;
      border-top-left-radius: 15px;
      border-top-right-radius: 15px;
      overflow: hidden;
    }
    @media screen and (max-width: 1024px) {
      border-top-left-radius: 0;
      border-top-right-radius: 0;
    }
    .wiertla-categories__table-container {
      overflow-y: auto;
      margin-bottom: 20px;
    }

    .wiertla-categories__table-row {
      min-height: 25px;
      line-height: 25px;
      transition: all 0.3s ease;
      cursor: pointer;
      position: relative;
      background-color: #f5f5f8;
    }

    .wiertla-categories__table-row:hover {
      background-color: #112832;
    }
    .wiertla-categories__table-row:hover td {
      color: #F5F5F8
    }
    .wiertla-categories__table-row:hover::after {
      content: "";
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      width: 24px;
      height: 24px;
      background-image: url("{{ 'table_arrow_right_yellow.svg' | asset_url }}");
      background-repeat: no-repeat;
      background-position: center;
      z-index: 5;
    }
    .wiertla-categories__table td:last-child {
      padding: 5.5px 30px 5.5px 17px;
    
    }
    .wiertla-categories__table td {
      padding: 5.5px 10px 5.5px 17px;
      min-height: 25px;
      line-height: normal;
      vertical-align: middle;
      position: relative;
      height: auto;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      font-family: 'Montserrat'
      , sans-serif;
      font-weight: 500;
      font-size: 16px;
      line-height: 22px;
      letter-spacing: 0.03em;
      color: #112832;
      border-right: 2px solid #E2E2E7;
    }

    .wiertla-categories__table td:empty::after {
      content: "...";
    }

    .wiertla-categories__table tr:not(:last-child) td {
      border-bottom: 1px solid #E2E2E7;
    }

    .wiertla-categories__table td img {
      vertical-align: middle;
      max-height: 24px;
      max-width: 22px;
      margin: auto 0;
    }

    .wiertla-categories__table th {
      height: 34px;
      line-height: 34px;
      padding: 5.5px 17px;
      vertical-align: middle;
      position: relative;
      text-align: left;
      font-family: 'League Spartan'
      , sans-serif;
      font-weight: 700;
      font-size: 18px;
      line-height: 100%;
      letter-spacing: 6%;
      color: #112832;
      background-color: white;
      border-bottom: 2px solid #E2E2E7;
      border-right: 2px solid #E2E2E7;
    }

    .wiertla-categories__table th:first-child {
      border-top-left-radius: 15px;
      border-left: 2px solid #E2E2E7;
    }

    .wiertla-categories__table th:last-child {
      border-top-right-radius: 15px;
      border-right: 2px solid #E2E2E7;
    }

    .wiertla-categories__table th {
      border-top: 2px solid #E2E2E7;
    }

    .wiertla-categories__table td:first-child {
      border-left: 2px solid #E2E2E7;
    }

    .wiertla-categories__table td:last-child {
      border-right: 2px solid #E2E2E7;
    }

    .wiertla-categories__table tr:last-child td {
      border-bottom: 2px solid #E2E2E7;
    }

    /* Hide the last column (info icon) */
    .wiertla-categories__table th:nth-child(7),
    .wiertla-categories__table td:nth-child(7) {
      display: none;
    }

    /* Hover preview styles */
    .wiertla-categories__hover-preview {
      position: fixed;
      width: 425px;
      height: 303.5714px;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.3s ease;
      z-index: 9999;
      background-color: transparent;
    }

    .wiertla-categories__hover-preview.active {
      opacity: 1;
    }

    .wiertla-categories__hover-preview-inner {
      position: relative;
      width: 100%;
      height: 100%;
    }

    .wiertla-categories__hover-preview-img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      border: 2px solid #E2E2E7;
      border-bottom-left-radius: 30px;
      background-color: #ffffff;
    }

    .wiertla-categories__hover-preview-arrow {
      position: absolute;
      right: -10px;
      top: 50%;
      transform: translateY(-50%);
      width: 0;
      height: 0;
      border-top: 10px solid transparent;
      border-left: 10px solid #E2E2E7;
      border-bottom: 10px solid transparent;
    }

    /* New hover styles */
    .wiertla-categories__image-hover {
      position: fixed;
      width: 425px;
      height: 303.5714px;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.3s ease;
      z-index: 9999;
      background-color: transparent;
    }

    .wiertla-categories__image-hover.active {
      opacity: 1;
    }

    .wiertla-categories__image-hover-inner {
      position: relative;
      width: 100%;
      height: 100%;
    }

    .wiertla-categories__image-hover-img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      border: 2px solid #E2E2E7;
      border-bottom-left-radius: 30px;
      background-color: #ffffff;
    }

    .wiertla-categories__image-hover-diamond {
      position: absolute;
      right: -2px;
      top: 50%;
      transform: translateY(-50%);
      width: 14px;
      height: 28px;
    }

    /* Preview component styles - keep this area static */
    .wiertla-categories__preview {
      width: 100%;
      padding: 20px;
      border: 2px dashed #E2E2E7;
      margin-top: 20px;
    }

    .wiertla-categories__preview-container {
      position: relative;
      width: 100%;
    }

    .wiertla-categories__preview-image {
      width: 100%;
    }

    .wiertla-categories__preview-image img {
      pointer-events: none;
      max-width: 100%;
    }

    .wiertla-categories__preview-hover {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 5;
    }

    .wiertla-categories__preview-hover-img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    /* Icon styles */
    .wiertla-categories__icons {
      display: flex;
      flex-wrap: wrap;
      gap: 0;
      justify-content: center;
      width: 100%;
    }

    .wiertla-categories__icon-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 191.7143px;
      height: 203px;
      padding: 20px 0;
      gap: 15px;
      cursor: pointer;
      transition: all 0.3s ease;
      border-radius: 10px;
      box-sizing: border-box;
    }
    .wiertla-categories__icon-item span {
      text-decoration: underline;
    }
    .wiertla-categories__icon-item.active span {
      text-decoration: none;
    }
    .wiertla-categories__icon-item:hover {
      background-color: #F5F5F8;
    }

    .wiertla-categories__icon {
      object-fit: cover;
    }
    @media screen and (max-width: 768px) {
      .wiertla-categories__icon {
        width: 122px;
      }
    }
    .wiertla-categories__icon-label {
      font-family: 'League Spartan'
      , sans-serif;
      font-weight: 700;
      font-size: 18px;
      line-height: 100%;
      letter-spacing: 0.06em;
      color: #112832;
      text-align: center;
      text-transform: uppercase;
      text-decoration: none;
    }

    /* Filter styles */
    .wiertla-categories__filters {
      display: flex;
      justify-content: space-between;
      margin-bottom: 30px;
      flex-wrap: wrap;
      width: 100%;
      gap: 20px;
      padding: 15px 15px 0;
      background: #F5F5F8;
      border-radius: 20px 20px 0 0;
    }
    .wiertla-categories__filters.desktop {
      background: white;
      margin-bottom: 0;
      padding-bottom: 20px;
    }

    .wiertla-categories__filters-left {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
    }

    .wiertla-categories__filters-right {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .wiertla-categories__filter {
      height: 40px;
      border: 2px solid #E2E2E7;
      border-radius: 30px;
      padding: 0 30px 0 20px;
      font-family: 'Montserrat'
      , sans-serif;
      font-weight: 500;
      font-size: 18px;
      line-height: 18px;
      color: #112832;
      background: #FFFFFF;
      cursor: pointer;
      appearance: none;
      -webkit-appearance: none;
      background-image: url("data:image/svg+xml, %3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='5' viewBox='0 0 10 5' fill='none'%3E%3Cpath d='M5 5L0 0H10L5 5Z' fill='%235F6368'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 10px center;
      background-size: 10px 5px;
    }

    .wiertla-categories__filter-button {
      height: 40px;
      padding: 0 20px;
      border: 2px solid #E2E2E7;
      border-radius: 30px;
      font-family: 'Montserrat'
      , sans-serif;
      font-weight: 500;
      font-size: 18px;
      line-height: 18px;
      color: #112832;
      background: #FFFFFF;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .wiertla-categories__filter-button.active {
      background: #112832;
      color: #F5F5F8;
      border-color: #112832;
    }

    .wiertla-categories__per-page-label {
      font-family: 'Montserrat'
      , sans-serif;
      font-weight: 500;
      font-size: 16px;
      line-height: 22px;
      color: #445D68;
    }

    .wiertla-categories__per-page-buttons {
      display: flex;
      gap: 5px;
    }

    .wiertla-categories__per-page-button {
      height: 42px;
      padding: 10px 22px;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 2px solid #E2E2E7;
      border-radius: 30px;
      font-family: 'Montserrat'
      , sans-serif;
      font-weight: 500;
      font-size: 18px;
      line-height: 18px;
      color: #112832;
      background: #FFFFFF;
      cursor: pointer;
      transition: all 0.3s ease;
      min-width: 67px;
    }

    .wiertla-categories__per-page-button.active {
      background: #112832;
      color: #F5F5F8;
      border-color: #112832;
    }

    .wiertla-categories__per-page-buttons {
      display: flex;
      gap: 10px;
    }

    /* Search input styles */
    .wiertla-categories__search .wiertla-search__input {
      width: 100%;
      height: 50px;
      border: 2px solid #E2E2E7;
      border-radius: 30px;
      padding: 11px 20px;
      font-family: "Montserrat";
      font-weight: 500;
      font-size: 18px;
      line-height: 100%;
      letter-spacing: 0.03em;
      color: #112832;
      background-color: white;
    }

    .wiertla-categories__search .wiertla-search__input::placeholder {
      color: #445D68;
    }

    /* Search icon positioned correctly */
    .wiertla-categories__search .wiertla-search__input-group {
      position: relative;
      border: none;
    }

    .wiertla-categories__search .wiertla-search__submit {
      position: absolute;
      right: 20px;
      top: 50%;
      transform: translateY(-50%);
      background: none;
      border: none;
      padding: 0;
    }

    .wiertla-categories__search .wiertla-search__submit svg {
      width: 24px;
      height: 24px;
      color: #112832;
    }

    .wiertla-categories__search .wiertla-search__icon-left {
      position: absolute;
      left: 20px;
      top: 50%;
      transform: translateY(-50%);
      width: 24px;
      height: 24px;
    }

    /* Fullscreen button style */
    .wiertla-categories__fullscreen-btn {
      display: flex;
      align-items: center;
      gap: 10px;
      width: 100%;
      height: 50px;
      padding: 11px 17px;
      margin-bottom: 20px;
      background: #FFE500;
      border: 2px solid #112832;
      border-radius: 30px;
      font-family: 'League Spartan'
      , sans-serif;
      font-weight: 700;
      text-transform: uppercase;
      flex-direction: row-reverse;
      font-size: 18px;
      line-height: 16.6px;
      letter-spacing: 0.06em;
      color: #112832;
      cursor: pointer;
      transition: all 0.3s ease;
      width: 100%;
      height: auto;
      margin-bottom: 20px;
    }

    .wiertla-categories__fullscreen-btn:hover {
      background: #FFD500;
    }

    .wiertla-categories__fullscreen-icon {
      width: 24px;
      height: 24px;
    }

    /* Preview component styles */
    .wiertla-categories__preview-title {
      font-family: 'League Spartan'
      , sans-serif;
      font-weight: 700;
      font-size: 18px;
      line-height: 16.6px;
      letter-spacing: 6%;
      text-transform: uppercase;
      color: #000000;
      margin-bottom: 20px;
    }

    .wiertla-categories__preview-image {
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      justify-content: flex-start;
    }

    .wiertla-categories__preview-img {
      max-width: 100%;
      height: auto;
    }

    .wiertla-categories__preview-text {
      font-family: 'Montserrat'
      , sans-serif;
      font-weight: 500;
      font-size: 16px;
      line-height: 22px;
      letter-spacing: 3%;
      color: #445D68;
    }

    /* Results styles */
    .wiertla-categories__results {
      margin-top: 20px;
    }

    .wiertla-categories__results-count {
      font-family: 'Montserrat'
      , sans-serif;
      font-weight: 500;
      font-size: 14px;
      line-height: 14px;
      color: #445D68;
    }

    /* Pagination button styles */
    .wiertla-categories__pagination-button {
      font-family: 'League Spartan'
      , sans-serif;
      font-weight: 700;
      font-size: 14px;
      line-height: 16.6px;
      letter-spacing: 6%;
      text-transform: uppercase;
      white-space: nowrap;
      padding: 0 15px;
      height: 40px;
      min-width: 120px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #112832;
      color: #F5F5F8;
      border: none;
      border-radius: 30px;
      cursor: pointer;
    }

    .wiertla-categories__pagination-button[disabled] {
      background: #E2E2E7;
      color: #445D68;
      cursor: not-allowed;
    }

    /* Desktop pagination text */
    @media screen and (min-width: 1024px) {
      .wiertla-categories__pagination-button span {
        display: inline-block;
      }

      .wiertla-categories__pagination-button::before {
        display: none;
      }
    }

    /* Mobile pagination text */
    @media screen and (max-width: 1023px) {
      .wiertla-categories__results-wrapper {
        flex-direction: column;
        gap: 15px;
        align-items: center;
      }

      .wiertla-categories__results-count {
        text-align: center;
        width: 100%;
      }

      .wiertla-categories__simple-pagination {
        width: 100%;
        justify-content: center;
        gap: 10px;
      }

      .wiertla-categories__pagination-button {
        min-width: 110px;
        height: 36px;
        font-size: 13px;
        padding: 0 12px;
        border-radius: 25px;
      }
    }

    /* Improved pagination text alignment */
    .wiertla-categories__simple-pagination {
      display: flex;
      align-items: center;
      gap: 20px;
    }

    .wiertla-categories__results-wrapper {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    /* Fullscreen mode styles */
    .wiertla-categories__fullscreen-view {
      display: none;
    }

    .wiertla-categories__fullscreen-mode .wiertla-categories__fullscreen-view {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: white;
      z-index: 1000;
      overflow-y: auto;
      padding: 40px;
      display: block;
    }

    .wiertla-categories__fullscreen-mode .wiertla-categories__content {
      display: none;
    }

    .wiertla-categories__fullscreen-header,
    .wiertla-categories__fullscreen-title,
    .wiertla-categories__fullscreen-filters,
    .wiertla-categories__fullscreen-layout,
    .wiertla-categories__fullscreen-left,
    .wiertla-categories__fullscreen-right {
      display: none;
    }

    .wiertla-categories__fullscreen-mode .wiertla-categories__fullscreen-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 40px;
    }

    .wiertla-categories__fullscreen-mode .wiertla-categories__fullscreen-title {
      max-width: 600px;
      display: block;
    }

    .wiertla-categories__fullscreen-mode .wiertla-categories__fullscreen-filters {
      margin-bottom: 40px;
      display: block;
    }

    .wiertla-categories__fullscreen-mode .wiertla-categories__fullscreen-layout {
      display: flex;
      gap: 40px;
    }

    .wiertla-categories__fullscreen-mode .wiertla-categories__fullscreen-left {
      width: 425px;
      flex-shrink: 0;
      display: block;
    }

    .wiertla-categories__fullscreen-mode .wiertla-categories__fullscreen-right {
      flex: 1;
      display: block;
    }

    .wiertla-categories__fullscreen-btn {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 11px 17px;
      background: #FFE500;
      border: 2px solid #112832;
      border-radius: 30px;
      font-family: 'League Spartan'
      , sans-serif;
      font-weight: 700;
      text-transform: uppercase;
      font-size: 18px;
      line-height: 16.6px;
      margin-bottom: 20px;
      letter-spacing: 0.06em;
      color: #112832;
      cursor: pointer;
      transition: all 0.3s ease;
      width: 100%;
      height: auto;
      margin-bottom: 20px;
    }

    .wiertla-categories__fullscreen-btn:hover {
      background: #FFD500;
    }

    .wiertla-categories__fullscreen-icon {
      width: 24px;
      height: 24px;
    }

    .wiertla-categories__fullscreen-close {
      display: flex;
      align-items: center;
      gap: 10px;
      width: 510px;
      height: 50px;
      padding: 11px 17px;
      background: #FFE500;
      border: 2px solid #112832;
      border-radius: 30px;
      font-family: 'League Spartan'
      , sans-serif;
      font-weight: 700;
      font-size: 18px;
      line-height: 16.6px;
      letter-spacing: 0.06em;
      color: #112832;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-left: auto;
    }

    .wiertla-categories__fullscreen-close:hover {
      background: #FFD500;
    }

    .wiertla-categories__fullscreen-content {
      max-width: 100%;
      padding: 0;
      box-sizing: border-box;
    }

    .wiertla-categories__fullscreen-container {
      padding: 0 40px 40px;
    }

    .wiertla-categories__fullscreen-layout {
      display: flex;
      gap: 40px;
      margin: 0 40px;
      max-width: 100%;
    }

    /* Fullscreen column styles */
    .wiertla-categories__fullscreen-left {
      width: 425px;
      flex-shrink: 0;
    }

    .wiertla-categories__fullscreen-right {
      flex: 1;
      padding-bottom: 40px;
    }

    /* Fullscreen pagination positioning fix */
    .wiertla-categories__fullscreen-mode .wiertla-categories__results {
      margin-bottom: 40px;
      margin-right: 40px;
      margin-left: 40px;
    }

    /* Responsive styles */
    @media (max-width: 1024px) {
      .wiertla-categories__layout {
        flex-direction: column;
      }

      .wiertla-categories__left-column,
      .wiertla-categories__right-column {
        width: 100%;
      }
    }

    @media (max-width: 768px) {
      /* Hide desktop elements on mobile */
      .wiertla-categories__icons:not(.mobile) {
        display: none;
      }

      /* Show mobile elements */
      .wiertla-categories__mobile-icons,
      .wiertla-categories__mobile-nav,
      .wiertla-categories__mobile-controls,
      .wiertla-categories__scroll-container,
      .wiertla-categories__scroll-indicator,
      .wiertla-categories__mobile-filter-btn,
      .wiertla-categories__mobile-sort-btn,
      .wiertla-categories__mobile-per-page {
        display: flex !important;
      }

      .wiertla-categories__mobile-filter-modal,
      .wiertla-categories__mobile-rent-modal {
        display: none;
      }

      .wiertla-categories__mobile-filter-modal.active,
      .wiertla-categories__mobile-rent-modal.active {
        display: block;
      }

      .wiertla-categories__mobile-icons {
        display: flex;
        overflow-x: auto;
        gap: 15px;
        margin-bottom: 20px;
        padding-bottom: 10px;
      }

      .wiertla-categories__filters {
        flex-direction: column;
      }

      .wiertla-categories__filters-left,
      .wiertla-categories__filters-right {
        width: 100%;
      }

      /* Mobile table header styles - ensure it only applies to mobile */
      @media screen and (max-width: 767px) {
        .wiertla-categories__table thead {
          display: none;
          /* Hide table header on mobile */
        }
      }

      .wiertla-categories__table td:first-child {
        border: none !important;
      }

      /* Table row styling */
      .wiertla-categories__table-row {
        background: white;
        border: 1px solid #E2E2E7;
        display: block;
        width: 100%;
        overflow: hidden;
        box-sizing: border-box;
      }
    }

    /* Table preview styles */
    .wiertla-categories__table-preview {
      display: none;
    }

    @media (max-width: 1024px) {
      .wiertla-categories__table-preview {
        width: 100%;
        padding: 20px;
        border: 2px dashed #E2E2E7;
        margin-top: 20px;
        display: block;
      }

      .wiertla-categories__table-preview .wiertla-categories__preview-image {
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .wiertla-categories__table-preview .wiertla-categories__preview-img {
        max-width: 100%;
        height: auto;
        object-fit: contain;
      }
    }

    /* Remove right border from last visible cell in each row */

    /* Filters background */.wiertla-categories__filters-background {
      width: 100%;
      background: #F5F5F8;
      padding: 20px 0 0;
    }

    .wiertla-categories__filters-container {
      max-width: 1440px;
      width: 100%;
      margin: 0 auto;
      padding: 0 20px;
    }
    @media screen and (max-width: 1024px) {

      .desktop {
        display: none !important;
      }
    }
    @media screen and (min-width: 1024px) {

      .mobile {
        display: none !important;
      }
    }
    .wiertla-categories__content {
      max-width: 1440px;
      width: 100%;
      margin: 0 auto;
      background: white;
      padding: 0 20px;
      border-radius: 15px;
    }
    body .bg_neutral {
      background: white;
    }
    /* Desktop table styles */
    @media screen and (min-width: 1024px) {
      .wiertla-categories__table-cell.mobile {
        display: none;
      }

      .wiertla-categories__table-cell.desktop {
        display: table-cell;
      }

      /* Make first cell smaller to fit just the icon */
      .wiertla-categories__table-cell:first-child {
        width: 50px;
        min-width: 50px;
        max-width: 50px;
        padding: 8px;
      }
    }

    /* Mobile table styles */
    @media screen and (max-width: 1023px) {
      .wiertla-categories__table-cell.desktop {
        display: none;
      }

      .wiertla-categories__table-cell-main.mobile {
        display: table-cell;
      }

      /* Hide table header on small screens only */
      .wiertla-categories__table thead {
        display: none;
      }
    }

    @media (max-width: 768px) {
      /* Additional mobile grid refinements */
      .wiertla-categories__table-cell-content {
        display: grid;
        grid-gap: 0;
        padding: 10px;
        width: 100%;
        box-sizing: border-box;
      }

      .wiertla-categories__table-cell-main.mobile {
        display: flex;
        width: 100%;
        padding: 0;
        margin: 0;
        border: none;
        box-sizing: border-box;
      }

      .wiertla-categories__table-row {
        border: 1px solid #E2E2E7;
        display: block;
        width: 100%;
        border-radius: 10px;
        overflow: hidden;
        box-sizing: border-box;
      }

      /* Reset any conflicting styles */
      .wiertla-categories__table td {
        padding: 0;
        margin: 0;
        border: none;
      }

      /* Ensure items in each row take up full space */
      .wiertla-categories__table-cell-primary,
      .wiertla-categories__table-cell-secondary {
        width: 100%;
        display: grid;
        box-sizing: border-box;
        grid-gap: 0;
      }

      .wiertla-categories__table-cell-primary {
        grid-template-columns: repeat(4, 1fr);
        margin-bottom: 10px;
        padding-bottom: 10px;
      }

      .wiertla-categories__table-cell-secondary {
        grid-template-columns: repeat(2, 1fr);
      }

      /* Style for all cells to ensure they touch without gaps */
      .wiertla-categories__table-cell-type,
      .wiertla-categories__table-cell-fi,
      .wiertla-categories__table-cell-length,
      .wiertla-categories__table-cell-price,
      .wiertla-categories__table-cell-vendor,
      .wiertla-categories__table-cell-symbol {
        text-align: center;
        background-color: #F5F5F8;
        padding: 8px 2px;
        display: flex;
        align-items: center;
        justify-content: center;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        box-sizing: border-box;
        border: 1px solid #E2E2E7;
        margin: 0;
        height: 100%;
      }

      /* Custom styling for specific cell types */
      .wiertla-categories__table-cell-type {
        font-weight: 700;
        color: #112832;
      }

      .wiertla-categories__table-cell-price {
        font-weight: 700;
        color: #112832;
      }

      .wiertla-categories__table-cell-vendor,
      .wiertla-categories__table-cell-symbol {
        color: #445D68;
      }

      /* Border fixes to prevent doubling */
      .wiertla-categories__table-cell-primary > div,
      .wiertla-categories__table-cell-secondary > div {
        margin: 0;
        border-right: none;
      }

      .wiertla-categories__table-cell-primary > div:last-child,
      .wiertla-categories__table-cell-secondary > div:last-child {
        border-right: 1px solid #E2E2E7;
      }

      /* Table layout fixes */
      .wiertla-categories__table {
        width: 100%;
        border-collapse: collapse;
        table-layout: fixed;
      }
    }
    @media (max-width: 768px) {
      .wiertla-categories__mobile-header-actions {
        display: flex;
        flex-direction: row;
        align-items: center;
        justify-content: space-between;
      }
      .wiertla-categories__mobile-filter-button {
        gap: 10px;
      }
      .wiertla-categories__mobile-filter-button,
      .wiertla-categories__mobile-pagination {
        display: flex;
        flex-direction: row;
        align-items: center;
        justify-content: flex-start;
      }
      .wiertla-rental-info__text {
        font-family: "Montserrat";
        font-weight: 500;
        font-size: 16px;
        line-height: 22px;
        letter-spacing: 0.03em;
        color: #112832;
      }
      .wiertla-rental-info {
        display: flex;
        flex-direction: row;
        align-items: flex-start;
        justify-content: center;
        gap: 10px;
        margin-top: 20px;
      }
    }
    @media (max-width: 768px) {
      /* Mobile table structure */
      .wiertla-categories__table {
        border-collapse: separate;
      }

      .wiertla-categories__table td:last-child {
        border: none !important;
      }
      .wiertla-categories__table-container {
        overflow-y: auto;
        margin-bottom: 20px;
      }

      /* Table header row should be displayed but customized */
      .wiertla-categories__table thead {
        display: table-header-group;
      }

      .wiertla-categories__table thead tr {
        display: flex;
        flex-direction: column;
        margin-bottom: 10px;
      }

      /* Mobile card styling to match Figma */
      .wiertla-categories__mobile-card {
        display: flex;
        flex-direction: column;
        width: 100%;
        background-color: #fff;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        text-decoration: none;
        cursor: pointer;
      }

      /* Top row styling */
      .wiertla-categories__mobile-top {
        display: flex;
        align-items: center;
        background: white;
      }

      .wiertla-categories__mobile-image {
        width: 34px;
        height: 34px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-top: 2px #112832 solid;
        border-right: 2px #112832 solid;
        border-bottom: 2px #112832 solid;
        border-left: 2px solid #112832;
      }

      .wiertla-categories__mobile-fi {
        width: 127px;
        height: 34px;
        padding: 1px 10px 0;
        border-top: 2px #112832 solid;
        border-right: 2px #112832 solid;
        border-bottom: 2px #112832 solid;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .mobile-label {
        color: #112832;
        font-size: 16px;
        font-family: Montserrat
        , sans-serif;
        font-weight: 500;
        line-height: 22px;
      }

      .mobile-value {
        color: #112832;
        font-size: 16px;
        font-family: 'League Spartan'
        , sans-serif;
        font-weight: 700;
      }

      .wiertla-categories__mobile-dimension {
        flex: 1 1 0;
        height: 34px;
        padding: 0 10px;
        display: flex;
        align-items: center;
        outline: 2px #112832 solid;
        outline-offset: -2px;
      }

      .wiertla-categories__mobile-price {
        height: 34px;
        padding: 0 10px;
        background: #FFE500;
        display: flex;
        align-items: center;
        outline: 2px #112832 solid;
        outline-offset: -2px;
      }

      /* Bottom row styling */
      .wiertla-categories__mobile-bottom {
        display: flex;
        width: 100%;
      }

      .wiertla-categories__mobile-vendor {
        width: 160px;
        height: 34px;
        padding: 0 10px;
        background: #F5F5F8;
        border-left: 2px #E2E2E7 solid;
        border-right: 2px #E2E2E7 solid;
        border-bottom: 2px #E2E2E7 solid;
        display: flex;
        align-items: center;
      }

      .wiertla-categories__mobile-symbol {
        flex: 1 1 0;
        height: 34px;
        padding: 0 10px;
        background: #F5F5F8;
        border-right: 2px #E2E2E7 solid;
        border-bottom: 2px #E2E2E7 solid;
        display: flex;
        align-items: center;
      }
    }

    @media (max-width: 768px) {
      /* Hide desktop headers but display mobile custom header - only on mobile */
      .wiertla-categories__table thead {
        display: none;
      }

      .wiertla-categories__search .wiertla-search__input {
        padding: 11px 40px 11px 14px;
      }
      /* Mobile Table Header */
      .wiertla-categories__mobile-table-header {
        display: flex;
        flex-direction: column;
        width: 100%;
      }

      .wiertla-categories__mobile-header-top {
        display: flex;
        align-items: center;
        background: white;
      }

      .wiertla-categories__mobile-header-bottom {
        display: flex;
        width: 100%;
      }

      .wiertla-categories__mobile-header-img {
        width: 34px;
        height: 34px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .wiertla-categories__mobile-header-img img {
        width: 34px;
        height: 34px;
        object-fit: contain;
      }

      .wiertla-categories__mobile-header-fi {
        width: 127px;
        height: 34px;
        padding: 1px 10px 0;
        border-top: 2px #112832 solid;
        border-right: 2px #112832 solid;
        border-bottom: 2px #112832 solid;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .wiertla-categories__mobile-header-fi div {
        color: #112832;
        font-size: 16px;
        font-family: 'League Spartan'
        , sans-serif;
        font-weight: 700;
        letter-spacing: 0.96px;
      }

      .wiertla-categories__mobile-header-dimension {
        flex: 1 1 0;
        height: 34px;
        padding: 0 10px;
        display: flex;
        align-items: center;
        outline: 2px #112832 solid;
        outline-offset: -2px;
      }

      .wiertla-categories__mobile-header-dimension div {
        color: #112832;
        font-size: 16px;
        font-family: 'League Spartan'
        , sans-serif;
        font-weight: 700;
        letter-spacing: 0.96px;
      }

      .wiertla-categories__mobile-header-price {
        height: 34px;
        padding: 0 10px;
        background: #FFE500;
        display: flex;
        align-items: center;
        outline: 2px #112832 solid;
        outline-offset: -2px;
      }

      .wiertla-categories__mobile-header-price div {
        color: #112832;
        font-size: 16px;
        font-family: 'League Spartan'
        , sans-serif;
        font-weight: 700;
        letter-spacing: 0.96px;
      }

      .wiertla-categories__mobile-header-vendor {
        width: 160px;
        height: 34px;
        padding: 0 10px;
        background: #F5F5F8;
        border-left: 2px #E2E2E7 solid;
        border-right: 2px #E2E2E7 solid;
        display: flex;
        align-items: center;
      }

      .wiertla-categories__mobile-header-vendor div {
        color: #112832;
        font-size: 16px;
        font-family: 'League Spartan'
        , sans-serif;
        font-weight: 700;
        letter-spacing: 0.96px;
      }

      .wiertla-categories__mobile-header-symbol {
        flex: 1 1 0;
        height: 34px;
        padding: 0 10px;
        background: #F5F5F8;
        border-right: 2px #E2E2E7 solid;
        display: flex;
        align-items: center;
      }

      .wiertla-categories__mobile-header-symbol div {
        color: #112832;
        font-size: 16px;
        font-family: 'League Spartan'
        , sans-serif;
        font-weight: 700;
        letter-spacing: 0.96px;
      }

      /* Mobile table container with scroll after 7 items */
      .wiertla-categories__table-container {
        overflow-y: auto;
        margin-bottom: 20px;
        max-height: unset;
        /* Remove any max-height on the container */
        display: block;
      }

      /* Apply max-height to the table itself on mobile */
      .wiertla-categories__table {
        max-height: calc(7 * 76px);
        display: block;
        overflow-y: auto;
        border-radius: 0;
      }
    }

    /* Mobile product row styles */
    @media (max-width: 768px) {
      .wiertla-categories__table-row {
        background: transparent;
        border: none;
        border-radius: 0;
      }

      .wiertla-categories__table td.wiertla-categories__table-cell-main.mobile {
        padding: 0;
        border: none;
      }

      /* Mobile card link styling */
      button.wiertla-categories__mobile-card {
        display: flex;
        flex-direction: column;
        width: 100%;
        text-decoration: none;
        color: inherit;
      }

      /* Top row with image, fi, dimension, price */
      .wiertla-categories__mobile-top {
        display: flex;
        align-items: center;
        width: 100%;
      }

      .wiertla-categories__mobile-image {
        width: 34px;
        height: 34px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .wiertla-categories__mobile-image img {
        width: 34px;
        height: 34px;
        object-fit: contain;
      }

      .wiertla-categories__mobile-fi {
        width: 127px;
        height: 34px;
        padding: 1px 10px 0;
        border-top: 2px #112832 solid;
        border-right: 2px #112832 solid;
        border-bottom: 2px #112832 solid;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .wiertla-categories__mobile-dimension {
        flex: 1 1 0;
        height: 34px;
        padding: 0 10px;
        display: flex;
        align-items: center;
        outline: 2px #112832 solid;
        outline-offset: -2px;
      }

      .wiertla-categories__mobile-price {
        height: 34px;
        padding: 0 10px;
        background: #FFE500;
        display: flex;
        align-items: center;
        outline: 2px #112832 solid;
        outline-offset: -2px;
      }

      /* Text styles */
      .mobile-label {
        color: #112832;
        font-size: 16px;
        font-family: Montserrat
        , sans-serif;
        font-weight: 500;
        line-height: 22px;
        letter-spacing: 0.48px;
      }

      .mobile-value {
        color: #112832;
        font-size: 16px;
        font-family: 'League Spartan'
        , sans-serif;
        font-weight: 700;
        letter-spacing: 0.96px;
      }

      .wiertla-categories__mobile-dimension {
        color: #112832;
        font-size: 16px;
        font-family: Montserrat
        , sans-serif;
        font-weight: 500;
        line-height: 22px;
        letter-spacing: 0.48px;
      }

      .wiertla-categories__mobile-price {
        color: #112832;
        font-size: 16px;
        font-family: Montserrat
        , sans-serif;
        font-weight: 500;
        line-height: 22px;
        letter-spacing: 0.48px;
      }

      /* Bottom row with vendor and symbol */
      .wiertla-categories__mobile-bottom {
        display: flex;
        width: 100%;
      }

      .wiertla-categories__mobile-vendor {
        width: 160px;
        height: 34px;
        padding: 0 10px;
        background: #F5F5F8;
        border-left: 2px #E2E2E7 solid;
        border-right: 2px #E2E2E7 solid;
        border-bottom: 2px #E2E2E7 solid;
        display: flex;
        align-items: center;
        color: #112832;
        font-size: 16px;
        font-family: Montserrat
        , sans-serif;
        font-weight: 500;
        line-height: 22px;
        letter-spacing: 0.48px;
      }

      .wiertla-categories__mobile-symbol {
        flex: 1 1 0;
        height: 34px;
        padding: 0 10px;
        background: #F5F5F8;
        border-right: 2px #E2E2E7 solid;
        border-bottom: 2px #E2E2E7 solid;
        display: flex;
        align-items: center;
        color: #112832;
        font-size: 16px;
        font-family: Montserrat
        , sans-serif;
        font-weight: 500;
        line-height: 22px;
        letter-spacing: 0.48px;
      }
    }

    /* Improved mobile styling for results and pagination */
    @media (max-width: 768px) {
      .wiertla-categories__results {
        margin-top: 20px;
        margin-bottom: 20px;
      }

      .wiertla-categories__results-wrapper {
        display: flex;
        flex-direction: column;
        gap: 10px;
        align-items: center;
        width: 100%;
      }

      .wiertla-categories__results-count {
        width: 100%;
        text-align: center;
        font-size: 13px;
        color: #445D68;
      }

      .wiertla-categories__simple-pagination {
        display: flex;
        justify-content: center;
        gap: 8px;
        width: 100%;
      }

      .wiertla-categories__pagination-button {
        min-width: 100px;
        height: 34px;
        padding: 0 12px;
        background: #112832;
        color: white;
        border: none;
        border-radius: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-family: 'League Spartan'
        , sans-serif;
        font-weight: 700;
        font-size: 14px;
        text-transform: uppercase;
        cursor: pointer;
        transition: background-color 0.3s ease;
      }

      .wiertla-categories__pagination-button span.mobile {
        display: block;
      }

      .wiertla-categories__pagination-button span.desktop {
        display: none;
      }

      .wiertla-categories__pagination-button:disabled {
        background-color: #E2E2E7;
        color: #445D68;
        cursor: not-allowed;
      }

      .wiertla-categories__pagination-button:hover:not(:disabled) {
        background-color: #1a3c4b;
      }

      /* Ensure mobile text shows properly */
      .wiertla-categories__results-text.desktop {
        display: none;
      }

      .wiertla-categories__results-text.mobile {
        display: inline;
      }
    }

    /* Extra small mobile screens */
    @media screen and (max-width: 420px) {
      .wiertla-categories__pagination-button {
        min-width: 90px;
        height: 32px;
        font-size: 12px;
        padding: 0 10px;
      }

      .wiertla-categories__results-count {
        font-size: 12px;
      }

      .wiertla-categories__simple-pagination {
        gap: 6px;
      }
    }

    /* Display control for desktop/mobile text in pagination buttons */
    @media screen and (min-width: 1024px) {
      .wiertla-categories__pagination-button span.desktop {
        display: inline-block;
      }

      .wiertla-categories__pagination-button span.mobile {
        display: none;
      }
    }

    @media screen and (max-width: 1023px) {
      .wiertla-categories__pagination-button span.desktop {
        display: none;
      }
      .wiertla-categories__mobile-preview-button-icon {
        height: 19px;
        width: 24px;
      }
      .wiertla-categories__pagination-button span.mobile {
        display: inline-block;
      }
    }

    /* Mobile filter bar */
    .wiertla-categories__mobile-filter-bar {
      display: none;
      width: 100%;
      padding-left: 19px;
      padding-right: 19px;
      background: white;
      border-top-left-radius: 30px;
      border-top-right-radius: 30px;
      flex-direction: column;
      justify-content: center;
      align-items: flex-start;
    }

    @media (max-width: 768px) {
      .wiertla-categories__mobile-filter-bar {
        display: flex;
      }
      .wiertla-categories__status-filters--mobile {
        padding: 15px;
        background: #F5F5F8;
      }
      .wiertla-categories__mobile-filter-bar {
        padding-top: 11px;
        padding-bottom: 11px;
      }
    }

    .wiertla-categories__mobile-filter-bar > div {
      display: flex;
      align-items: center;
      width: 100%;
      justify-content: space-between;
    }

    .wiertla-categories__mobile-filter-left {
      flex: 1 1 0;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .wiertla-categories__mobile-filter-icon {
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .wiertla-categories__mobile-filter-text {
      color: #112832;
      font-size: 16px;
      font-family: 'League Spartan'
      , sans-serif;
      font-weight: 700;
      text-decoration: underline;
      text-transform: uppercase;
      letter-spacing: 0.96px;
    }

    .wiertla-categories__mobile-filter-right {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .wiertla-categories__mobile-per-page-buttons {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .wiertla-categories__header.desktop {
      background: #f5f5f8;
    }
    @media (min-width: 768px) {
      .wiertla-categories {
        background: #f5f5f8;
      }
    }
    .wiertla-categories__mobile-per-page-button {
      padding: 10px 11px;
      border-radius: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: 'Montserrat'
      , sans-serif;
      font-weight: 500;
      font-size: 16px;
      color: #5D7077;
      background: #F5F5F8;
      border: none;
      cursor: pointer;
    }
    @media screen and (max-width: 1024px) {

      #productsTableBody {
        display: grid;
      }
    }
    .wiertla-categories__mobile-per-page-button.active {
      color: #112832;
      background: white;
      outline: 2px #112832 solid;
      outline-offset: -2px;
    }

    .wiertla-categories__mobile-per-page-label {
      color: #112832;
      font-size: 16px;
      font-family: 'Montserrat'
      , sans-serif;
      font-weight: 500;
      line-height: 22px;
      letter-spacing: 0.48px;
    }

    @media screen and (min-width: 1024px) {
      .mobile {
        display: none !important;
      }

      /* Ensure table header is always visible on desktop */
      .wiertla-categories__table thead {
        display: table-header-group !important;
      }
    }

    /* Existing styles... */

    .wiertla-categories__status-filters--mobile {
      display: none;
      gap: 10px;
    }

    .wiertla-categories__status-filter {
      width: 121px;
      height: 40px;
      padding: 10px 22px;
      border-radius: 30px;
      border: 2px solid #E2E2E7;
      background: transparent;
      font-family: 'Montserrat'
      , sans-serif;
      font-size: 14px;
      font-weight: 700;
      color: #112832;
      background: white;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    .wiertla-categories__status-filter.wider {
      width: 150px;
    }
    .wiertla-categories__status-filter.active {

      background: #F5F5F8;

    }
    @media screen and (max-width: 768px) {
      .wiertla-categories__status-filter {
        max-width: 100px;
      }
    }
    .wiertla-categories__status-filters--mobile .wiertla-categories__status-filter.active {
      background: #F5F5F8;
      border: 2px solid #112832;
    }

    @media screen and (max-width: 768px) {
      .wiertla-categories__status-filters--mobile {
        display: flex;
        justify-content: flex-start;
        margin-bottom: 0;
      }
    }
  {% endstyle %}

  {% assign drill_stats_nav = sections['drill-stats-nav'] %}
  {% render 'drill-stats-nav' %}


{% endpaginate %}

{% schema %}
  {
    "name": "Wiertla Categories",
    "tag": "section",
    "class": "wiertla-categories-section",
    "settings": [
      {
        "type": "collection",
        "id": "selected_collection",
        "label": "Select Collection to Display",
        "info": "Choose which collection's products to display in this section"
      }, {
        "type": "range",
        "id": "items_per_page",
        "label": "Products per page",
        "default": 20,
        "min": 10,
        "max": 1000,
        "step": 10
      }, {
        "type": "text",
        "id": "title",
        "label": "Title",
        "default": "Wiertla Categories"
      }
    ],
    "presets": [
      {
        "name": "Wiertla Categories",
        "category": "Custom"
      }
    ]
  }
{% endschema %}

<script>
  
  // Make the openFilterModal function globally available
  window.openFilterModal = function() {
    const modal = document.querySelector('.wiertla-categories__mobile-filter-modal');
    if (modal) {
      // Force all style properties directly
      modal.style.display = "block";
      modal.style.visibility = "visible";
      modal.style.opacity = "1";
      modal.style.pointerEvents = "auto";
      modal.classList.add("active");
      document.body.style.overflow = "hidden";
    } else {
      console.error("Modal not found in global function");
    }
    return false;
  };
  
  // Close modal function
  window.closeFilterModal = function() {
    const modal = document.querySelector('.wiertla-categories__mobile-filter-modal');
    if (modal) {
      modal.style.display = "none";
      modal.style.visibility = "hidden";
      modal.style.opacity = "0";
      modal.style.pointerEvents = "none";
      modal.classList.remove("active");
      document.body.style.overflow = "";
    }
  };
  
  // Wait for full DOM loading
  document.addEventListener('DOMContentLoaded', function() {
    
    // Direct targeting of the filter button by ID
    const filterButtonTrigger = document.getElementById('mobile-filter-button-trigger');
    
    const mobileFilterModal = document.querySelector('.wiertla-categories__mobile-filter-modal');
    
    // Direct click handler for the ID-based button
    if (filterButtonTrigger) {
      filterButtonTrigger.addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        
        window.openFilterModal();
      });
    }
    
    // Also check all buttons with class
    const filterButtons = document.querySelectorAll('.wiertla-categories__mobile-filter-button');
    
    filterButtons.forEach(function(btn, index) {
      btn.addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        
        window.openFilterModal();
      });
    });
    
    // Close buttons
    const closeButtons = document.querySelectorAll('.wiertla-categories__mobile-filter-close, .wiertla-categories__mobile-filter-close-wrapper');
    closeButtons.forEach(function(btn) {
      btn.addEventListener('click', function() {
        window.closeFilterModal();
      });
    });
    
    // Close when clicking outside
    if (mobileFilterModal) {
      mobileFilterModal.addEventListener('click', function(e) {
        if (e.target === mobileFilterModal) {
          window.closeFilterModal();
        }
      });
    }
  });
</script>

<!-- Direct Modal Fallback -->
<div id="wiertla-filter-modal-fallback" class="wiertla-filter-modal">
  <div class="wiertla-filter-modal__content">
    <div class="wiertla-filter-modal__header">
      <div class="wiertla-filter-modal__icon">
        <img src="{{ 'icon_filter.svg' | asset_url }}" alt="Filter">
      </div>
      <div class="wiertla-filter-modal__title">
        filtruj wiertła w tabeli
      </div>
      <div class="wiertla-filter-modal__close" onclick="closeFilterModal()">
        <img src="{{ 'closee.svg' | asset_url }}" alt="Close">
      </div>
    </div>

    <div class="wiertla-filter-modal__buttons">
      <button class="wiertla-filter-modal__button wiertla-filter-modal__button--active" data-filter="type">Typ wiertła</button>
      <button class="wiertla-filter-modal__button" data-filter="crown">Wykaz koronek</button>
      <button class="wiertla-filter-modal__button" data-filter="manufacturer">Producent</button>
    </div>

    <div class="wiertla-filter-modal__section">
      <div class="wiertla-filter-modal__section-title">Pokaż</div>
      <div class="wiertla-filter-modal__dropdown" onclick="toggleDropdown('show-all')">
        <span>Wszystkie</span>
        <img src="{{ 'arrow_down.svg' | asset_url }}" alt="Dropdown">
      </div>
      <div id="show-all-dropdown" class="wiertla-filter-modal__dropdown-content">
        <div class="wiertla-filter-modal__dropdown-item" onclick="clearAllFilters()">Wyczyść wszystkie filtry</div>
        <div class="wiertla-filter-modal__dropdown-item" onclick="selectAllItems()">Zaznacz wszystkie</div>
        <div class="wiertla-filter-modal__dropdown-item" onclick="deselectAllItems()">Odznacz wszystkie</div>
      </div>
    </div>

    <div class="wiertla-filter-modal__section">
      <div class="wiertla-filter-modal__section-title">Sortuj</div>
      <div class="wiertla-filter-modal__dropdown" onclick="toggleDropdown('sort')">
        <span>Wybierz sortowanie</span>
        <img src="{{ 'arrow_down.svg' | asset_url }}" alt="Dropdown">
      </div>
      <div id="sort-dropdown" class="wiertla-filter-modal__dropdown-content">
        <div class="wiertla-filter-modal__dropdown-item" onclick="sortTable('name')">Nazwa (A-Z)</div>
        <div class="wiertla-filter-modal__dropdown-item" onclick="sortTable('name-desc')">Nazwa (Z-A)</div>
        <div class="wiertla-filter-modal__dropdown-item" onclick="sortTable('manufacturer')">Producent (A-Z)</div>
        <div class="wiertla-filter-modal__dropdown-item" onclick="sortTable('manufacturer-desc')">Producent (Z-A)</div>
      </div>
    </div>

    <div class="wiertla-filter-modal__section">
      <button class="wiertla-filter-modal__sort-button" onclick="applyFilters()">
        <span>Sortuj wiertła</span>
        <img src="{{ 'icon_filter.svg' | asset_url }}" alt="Sort">
      </button>
    </div>
  </div>
</div>



<!-- Mobile Preview Modal -->
<div class="wiertla-categories__mobile-preview-modal">
  <div class="wiertla-categories__mobile-preview-wrapper">
    <div class="wiertla-categories__mobile-preview-header">
      <div class="wiertla-categories__mobile-preview-title">PODGLĄD</div>
      <div class="wiertla-categories__mobile-preview-close-wrapper">
        <img
          src="{{ 'ico_close.svg' | asset_url }}"
          alt="Close"
          class="wiertla-categories__mobile-preview-close"
          data-translate="common.close_icon">
      </div>
    </div>

    <div class="wiertla-categories__mobile-preview-info">
      <!-- Diameter and size -->
      <div class="wiertla-categories__mobile-preview-specs">
        <div class="wiertla-categories__mobile-preview-type">
          <img
            src="{{ 'ico_big_all.svg' | asset_url }}"
            alt="Type"
            class="wiertla-categories__mobile-preview-type-icon">
        </div>
        <div class="wiertla-categories__mobile-preview-diameter">
          <div class="wiertla-categories__mobile-preview-diameter-label">fi ⌀</div>
          <div class="wiertla-categories__mobile-preview-diameter-value">-</div>
        </div>
        <div class="wiertla-categories__mobile-preview-size">
          <span class="wiertla-categories__mobile-preview-label">Wymiar:</span>
          <div class="wiertla-categories__mobile-preview-size-value">-</div>
        </div>
        <div class="wiertla-categories__mobile-preview-price">
          <div class="wiertla-categories__mobile-preview-price-value">-</div>
          <div class="wiertla-categories__mobile-preview-cart-icon">
            <img
              src="{{ 'cart_icon.svg' | asset_url }}"
              alt="Add to cart"
              data-translate="common.add_to_cart">
          </div>
        </div>
      </div>

      <!-- Manufacturer and SKU -->
      <div class="wiertla-categories__mobile-preview-details">
        <div class="wiertla-categories__mobile-preview-manufacturer">
          <div class="wiertla-categories__mobile-preview-manufacturer-value">-</div>
        </div>
        <div class="wiertla-categories__mobile-preview-sku">
          <div class="wiertla-categories__mobile-preview-sku-value">-</div>
        </div>
      </div>
    </div>

    <div class="wiertla-categories__mobile-preview-button-container">
      <a href="#" class="wiertla-categories__mobile-preview-button">
        <span>Zobacz szczegóły</span>
        <img
          src="{{ 'icon_filter.svg' | asset_url }}"
          alt="Details"
          class="wiertla-categories__mobile-preview-button-icon">
      </a>
    </div>
  </div>
</div>

<div class="wiertla-categories__fullscreen-view" style="display: none;">
  <div class="wiertla-categories__fullscreen-header">
    <div class="wiertla-categories__fullscreen-title">
      <h2>Przeglądaj wiertła w tabeli</h2>
      <p>Stale poszerzamy stan magazynowy, aktualizując ofertę o nowe modele wierteł CNC</p>
    </div>
    <button class="wiertla-categories__fullscreen-btn">
      <img
        src="{{ 'zoom_out_map.svg' | asset_url }}"
        alt="Close fullscreen"
        class="wiertla-categories__fullscreen-icon">
      <span>Zamknij tryb pełnoekranowy</span>
    </button>
  </div>

  <div class="wiertla-categories__fullscreen-filters">
    {% render 'wiertla-categories-filters' %}
  </div>

  <div class="wiertla-categories__fullscreen-content">
    <div class="wiertla-categories__fullscreen-layout">
      <div class="wiertla-categories__fullscreen-left">
        {% render 'wiertla-categories-search' %}
      </div>
      <div class="wiertla-categories__fullscreen-right">
        {% render 'wiertla-categories-table' %}
      </div>
    </div>
  </div>
</div>

<style>
  .wiertla-categories__price-wrapper,
    .wiertla-categories__mobile-price-wrapper {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .wiertla-categories__rent-button span  {
      font-family: Montserrat;
font-weight: 700;
font-size: 12px;
line-height: 16px;
letter-spacing: 1%;
text-transform: lowercase;
    }
    .wiertla-categories__rent-button,
    .wiertla-categories__mobile-rent-button {
      display: flex;
      align-items: center;
      gap: 10px;
      width: 82px;
      height: 24px;
      border-radius: 14px;
      border: 2px solid #112832;
      padding: 4px 8px;
      background-color: #F5F5F8;
      color: #112832;
      font-size: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .wiertla-categories__rent-button:hover,
    .wiertla-categories__mobile-rent-button:hover {
      background-color: #112832;
      color: #F5F5F8;
    }
    
    .wiertla-categories__rent-button img,
    .wiertla-categories__mobile-rent-button img {
      width: 12px;
      height: 12px;
    }
  .wiertla-categories__fullscreen-view {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: white;
    z-index: 1000;
    overflow-y: auto;
    padding: 40px;
  }

  .wiertla-categories__fullscreen-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 40px;
  }

  .wiertla-categories__fullscreen-title {
    max-width: 600px;
  }

  .wiertla-categories__fullscreen-title h2 {
    font-family: 'League Spartan'
    , sans-serif;
    font-weight: 700;
    font-size: 32px;
    line-height: 1.2;
    color: #112832;
    margin-bottom: 16px;
  }

  .wiertla-categories__fullscreen-title p {
    font-family: 'Montserrat'
    , sans-serif;
    font-weight: 500;
    font-size: 16px;
    line-height: 1.5;
    color: #5D7077;
  }

  .wiertla-categories__fullscreen-filters {
    margin-bottom: 40px;
  }

  .wiertla-categories__fullscreen-layout {
    display: flex;
    gap: 40px;
  }

  .wiertla-categories__fullscreen-left {
    width: 425px;
    flex-shrink: 0;
  }

  .wiertla-categories__fullscreen-right {
    flex: 1;
  }

  .wiertla-categories__fullscreen-btn {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 11px 17px;
    background: #FFE500;
    border: 2px solid #112832;
    border-radius: 30px;
    font-family: 'League Spartan'
    , sans-serif;
    font-weight: 700;
    text-transform: uppercase;
    font-size: 18px;
    line-height: 16.6px;
    letter-spacing: 0.06em;
    color: #112832;
    cursor: pointer;
    transition: all 0.3s ease;
    width: 100%;
    height: auto;
    margin-bottom: 20px;
  }

  .wiertla-categories__fullscreen-btn:hover {
    background: #FFD500;
  }

  .wiertla-categories__fullscreen-icon {
    width: 24px;
    height: 24px;
  }
  .wiertla-logos__row {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
    justify-content: center;
    align-items: center;
    padding: 20px;
    max-width: 100%;
    overflow: hidden;
  }

  @media screen and (max-width: 768px) {
    .wiertla-logos__row {
      gap: 15px;
      padding: 15px;
    }
    
    .wiertla-logos__item {
      flex: 0 0 calc(33.333% - 15px);
      max-width: calc(33.333% - 15px);
    }
  }

  @media screen and (max-width: 480px) {
    .wiertla-logos__row {
      gap: 10px;
      padding: 10px;
    }
    
    .wiertla-logos__item {
      flex: 0 0 calc(50% - 10px);
      max-width: calc(50% - 10px);
    }
  }

.wiertla-banner {
  position: relative;
  width: 100%;
  overflow: hidden;
  padding: 40px 20px;
  text-align: center;
}




</style>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Status filter functionality
    const statusFilters = document.querySelectorAll('.wiertla-categories__status-filters.desktop .wiertla-categories__status-filter');
    console.log('Initial status filters:', statusFilters);
    
    // Log initial active states
    statusFilters.forEach(filter => {
      console.log('Filter:', filter.textContent.trim(), 'Active:', filter.classList.contains('active'));
    });

    // Remove any initial active states
    statusFilters.forEach(filter => {
      filter.classList.remove('active');
    });

    // Check URL parameters for condition
    const params = new URLSearchParams(window.location.search);
    const conditionFromUrl = params.get('condition');
    
    if (conditionFromUrl) {
      // Find and activate the matching filter
      statusFilters.forEach(filter => {
        if (filter.textContent.trim().toLowerCase() === conditionFromUrl.toLowerCase()) {
          filter.classList.add('active');
        }
      });
    }

    // Rest of your existing code...
  });
  const desktopTabs = document.querySelectorAll('.wiertla-categories__tabs.desktop .wiertla-categories__tab');
  
  // Add click event listener to each tab
  desktopTabs.forEach(tab => {
    tab.addEventListener('click', function() {
      // Remove active class from all tabs
      desktopTabs.forEach(t => t.classList.remove('active'));
      
      // Add active class to clicked tab
      this.classList.add('active');
      
      // Get the tab text to use as a filter
      const tabText = this.textContent.trim();
      
      // Set the filter state based on the tab
      if (tabText.includes('PŁYTKI')) {
        filterState.type = 'plate';
      } else if (tabText.includes('KORONKI')) {
        filterState.type = 'crown';
      } else if (tabText.includes('REGENERACJA')) {
        filterState.type = 'regeneration';
      }
      
      // Apply filters to update the table
      applyFilters();
    });
  });
</script>

<style>
  /* Hide icons in fullscreen view */
  .wiertla-categories__fullscreen-view .wiertla-categories__icons {
    display: none !important;
  }

  /* Update fullscreen button styles */
  .wiertla-categories__fullscreen-btn {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 11px 17px;
    background: #FFE500;
    border: 2px solid #112832;
    border-radius: 30px;
    font-family: 'League Spartan'
    , sans-serif;
    font-weight: 700;
    text-transform: uppercase;
    font-size: 18px;
    margin-bottom: 20px;
    line-height: 16.6px;
    letter-spacing: 0.06em;
    color: #112832;
    cursor: pointer;
    transition: all 0.3s ease;
    width: 100%;
    height: auto;
    margin-bottom: 20px;
  }
  .wiertla-categories__fullscreen-header .wiertla-categories__fullscreen-btn {
    width: auto;

  }

  /* Desktop table styles */
  @media screen and (min-width: 1024px) {
    .wiertla-categories__table-cell.mobile {
      display: none;
    }

    .wiertla-categories__table-cell.desktop {
      display: table-cell;
    }

    /* Make first cell smaller to fit just the icon */
    .wiertla-categories__table > tbody > tr > td:first-child {
      width: 50px !important;
      min-width: 50px !important;
      max-width: 50px !important;
      padding: 8px !important;
      text-align: center !important;
    }
  }
</style>

<script>
  function toggleFullscreen() {
    const container = document.querySelector('.wiertla-categories__container');
    const fullscreenBtn = document.querySelector('.wiertla-categories__fullscreen-btn');
    const table = document.querySelector('.wiertla-categories__table');
    const rightSection = document.querySelector('.wiertla-categories__fullscreen-right');
    
    if (!container || !fullscreenBtn || !table || !rightSection) return;
    
    if (container.classList.contains('fullscreen')) {
      // Exit fullscreen
      container.classList.remove('fullscreen');
      fullscreenBtn.innerHTML = `
        <img src="{{ 'zoom_out_map.svg' | asset_url }}" alt="Fullscreen" width="24" height="24" class="wiertla-categories__fullscreen-icon">
        <span>Pełny ekran</span>
      `;
      document.body.style.overflow = '';
      
      // Move table back to its original container
      const tableContainer = document.querySelector('.wiertla-categories__table-container');
      if (tableContainer) {
        tableContainer.appendChild(table);
      }
    } else {
      // Enter fullscreen
      container.classList.add('fullscreen');
      fullscreenBtn.innerHTML = `
        <img src="{{ 'zoom_out_map.svg' | asset_url }}" alt="Close fullscreen" width="24" height="24" class="wiertla-categories__fullscreen-icon">
        <span>Zamknij tryb pełnoekranowy</span>
      `;
      document.body.style.overflow = 'hidden';
      
      // Move table to fullscreen container
      rightSection.appendChild(table);
      
      // Ensure table is visible and properly styled
      table.style.width = '100%';
      table.style.margin = '0';
      table.style.borderCollapse = 'collapse';
      
      // Ensure right section is properly styled
      rightSection.style.flex = '1';
      rightSection.style.overflow = 'auto';
      rightSection.style.padding = '20px';
    }
  }

  // Add styles for fullscreen mode
  const style = document.createElement('style');
  style.textContent = `
    .wiertla-categories__container.fullscreen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      z-index: 1000;
      background: white;
      display: flex;
      flex-direction: row;
    }
    
    .wiertla-categories__fullscreen-right {
      flex: 1;
      overflow: auto;
      padding: 20px;
    }
    
    .wiertla-categories__table {
      width: 100%;
      margin: 0;
      border-collapse: collapse;
    }
  `;
  document.head.appendChild(style);
</script>

<script>
  // Update category mappings
  window.WiertlaCNC.categoryMappings = {
    'koronkowe': 'VW',
    'plytkowe': 'PR',
    'vhm': 'VH',
    'sandvik': 'SANDVIK',
    'amec': 'AMEC',
    'ksem': 'KSEM',
    'iscar': 'ISCAR',
    'walter': 'WALTER',
    'GÜHRING': 'GÜHRING',
    'wnt': 'WNT',
    'mikrontool': 'MIKRONTOOL',
    'taegutec': 'TaeguTec'
  };

  // Update icon mappings
  window.WiertlaCNC.iconMappings = {
    'koronkowe': '{{ 'ico_big_koronkowe.svg' | asset_url }}',
    'plytkowe': '{{ 'ico_big_plytkowe.svg' | asset_url }}',
    'vhm': '{{ 'ico_big_vhm.svg' | asset_url }}',
    'sandvik': '{{ 'ico_big_sandvik.svg' | asset_url }}',
    'amec': '{{ 'ico_big_amec.svg' | asset_url }}',
    'ksem': '{{ 'ico_big_ksem.svg' | asset_url }}',
    'iscar': '{{ 'ico_big_iscar.svg' | asset_url }}',
    'walter': '{{ 'ico_big_walter.svg' | asset_url }}'
  };

  function applyFilters() {
    const selectedCategory = document.querySelector('.wiertla-categories__icon-item.active')?.getAttribute('data-category');
    const selectedStatus = document.querySelector('.wiertla-categories__status-item.active')?.getAttribute('data-status');
    let filteredProducts = window.WiertlaCNC.products;
    
    // Apply category filter
    if (selectedCategory && selectedCategory !== 'wszystkie') {
      const categoryCode = window.WiertlaCNC.categoryMappings[selectedCategory];
      filteredProducts = filteredProducts.filter(product => {
        return product.custom_category === categoryCode;
      });
    }
    
    // Apply status filter
    if (selectedStatus && selectedStatus !== 'all') {
      filteredProducts = filteredProducts.filter(product => {
        if (selectedStatus === 'rentable') {
          return product.rentable === true;
        } else if (selectedStatus === 'non-rentable') {
          return product.rentable === false;
        }
        return true;
      });
    }
    
    // Apply manufacturer filter
    if (selectedManufacturer && selectedManufacturer !== 'all') {
      const manufacturerMapping = {
        'sandvik': 'SA',
        'amec': 'AM',
        'ksem': 'KS',
        'iscar': 'IS',
        'walter': 'WA'
      };
      const expectedManufacturer = manufacturerMapping[selectedManufacturer];
      if (expectedManufacturer) {
        filteredProducts = filteredProducts.filter(product => {
          return product.vendor && product.vendor.toLowerCase().includes(expectedManufacturer.toLowerCase());
        });
      }
    }
    
    // Update table with filtered products
    generateTable(filteredProducts);
    
    // Update results count
    const resultsCount = document.querySelector('.wiertla-categories__results-count');
    if (resultsCount) {
      resultsCount.textContent = `${filteredProducts.length} wyników`;
    }
  }

  // Add event listeners for category icons
  document.querySelectorAll('.wiertla-categories__icon-item').forEach(icon => {
    icon.addEventListener('click', function() {
      // Remove active class from all icons
      document.querySelectorAll('.wiertla-categories__icon-item').forEach(i => i.classList.remove('active'));
      // Add active class to clicked icon
      this.classList.add('active');
      // Apply filters
      applyFilters();
    });
  });
</script>

<script>
  // Global filter state
  window.WiertlaCNC.filters = {
    category: 'wszystkie',
    status: 'all',
    type: 'all',
    crown: 'all',
    manufacturer: 'all',
    page: 1,
    perPage: 10
  };

  // Function to update URL parameters
  function updateUrlParams() {
    const params = new URLSearchParams(window.location.search);
    
    // Update all filter parameters
    const filterKeys = ['category', 'status', 'type', 'crown', 'manufacturer', 'page', 'perPage'];
    filterKeys.forEach(key => {
      if (window.WiertlaCNC.filters[key] !== 'all' && window.WiertlaCNC.filters[key] !== 1) {
        params.set(key, window.WiertlaCNC.filters[key]);
      } else {
        params.delete(key);
      }
    });
    
    const newUrl = window.location.pathname + (params.toString() ? '?' + params.toString() : '');
    window.history.replaceState({}, '', newUrl);
  }

  // Function to read parameters from URL
  function readUrlParams() {
    const params = new URLSearchParams(window.location.search);
    window.WiertlaCNC.filters = {
      category: params.get('category') || 'wszystkie',
      status: params.get('status') || 'all',
      type: params.get('type') || 'all',
      crown: params.get('crown') || 'all',
      manufacturer: params.get('manufacturer') || 'all',
      page: parseInt(params.get('page')) || 1,
      perPage: parseInt(params.get('perPage')) || 10
    };
  }

  // Function to apply filters
  function applyFilters() {
    const filteredProducts = window.products.filter(product => {
      // Category filter
      if (window.WiertlaCNC.filters.category && product.custom_category !== window.WiertlaCNC.filters.category) {
        return false;
      }
      
      // Manufacturer filter
      if (window.WiertlaCNC.filters.manufacturer) {
        const manufacturerMapping = {
          'sandvik': 'SA',
          'amec': 'AM',
          'ksem': 'KS',
          'iscar': 'IS',
          'walter': 'WA'
        };
        const expectedManufacturer = manufacturerMapping[window.WiertlaCNC.filters.manufacturer];
        if (!expectedManufacturer) return false;
        if (!product.vendor || !product.vendor.toLowerCase().includes(expectedManufacturer.toLowerCase())) {
          return false;
        }
      }
      
      // Status filter
      if (window.WiertlaCNC.filters.status) {
        if (window.WiertlaCNC.filters.status === 'rentable' && !product.rentable) {
          return false;
        }
        if (window.WiertlaCNC.filters.status === 'non-rentable' && product.rentable) {
          return false;
        }
      }
      
      return true;
    });
    
    // Update pagination
    window.totalPages = Math.ceil(filteredProducts.length / window.WiertlaCNC.filters.perPage);
    if (window.WiertlaCNC.filters.page > window.totalPages) {
      window.WiertlaCNC.filters.page = 1;
    }
    
    // Update URL parameters
    updateUrlParams();
    
    // Generate table with filtered products
    generateTable(filteredProducts);
  }

  // Function to update pagination controls
  function updatePaginationControls(totalItems) {
    const totalPages = Math.ceil(totalItems / window.WiertlaCNC.filters.perPage);
    const paginationContainer = document.querySelector('.wiertla-categories__pagination');
    
    if (paginationContainer) {
      let paginationHTML = '';
      
      // Previous button
      paginationHTML += `
        <button class="wiertla-categories__pagination-btn ${window.WiertlaCNC.filters.page === 1 ? 'disabled' : ''}" 
                onclick="changePage(${window.WiertlaCNC.filters.page - 1})">
          Poprzednia
        </button>
      `;
      
      // Page numbers
      for (let i = 1; i <= totalPages; i++) {
        paginationHTML += `
          <button class="wiertla-categories__pagination-btn ${window.WiertlaCNC.filters.page === i ? 'active' : ''}" 
                  onclick="changePage(${i})">
            ${i}
          </button>
        `;
      }
      
      // Next button
      paginationHTML += `
        <button class="wiertla-categories__pagination-btn ${window.WiertlaCNC.filters.page === totalPages ? 'disabled' : ''}" 
                onclick="changePage(${window.WiertlaCNC.filters.page + 1})">
          Następna
        </button>
      `;
      
      paginationContainer.innerHTML = paginationHTML;
    }
  }

  // Function to change page
  function changePage(newPage) {
    window.WiertlaCNC.filters.page = newPage;
    applyFilters();
  }

  // Initialize filters from URL on page load
  document.addEventListener('DOMContentLoaded', function() {
    // Read initial parameters from URL
    readUrlParams();
    
    // Set active states based on URL parameters
    const filterTypes = ['category', 'status', 'type', 'crown', 'manufacturer'];
    filterTypes.forEach(type => {
      const element = document.querySelector(`.wiertla-categories__${type}-item[data-${type}="${window.WiertlaCNC.filters[type]}"]`);
      if (element) {
        element.classList.add('active');
      }
    });
    
    // Apply initial filters
    applyFilters();
    
    // Add event listeners for all filter types
    filterTypes.forEach(type => {
      document.querySelectorAll(`.wiertla-categories__${type}-item`).forEach(item => {
        item.addEventListener('click', function() {
          // Remove active class from all items of this type
          document.querySelectorAll(`.wiertla-categories__${type}-item`).forEach(i => i.classList.remove('active'));
          // Add active class to clicked item
          this.classList.add('active');
          // Reset to first page when changing filters
          window.WiertlaCNC.filters.page = 1;
          // Apply filters
          applyFilters();
        });
      });
    });
  });

  // Add event listener for category select
  document.querySelector('.wiertla-categories__filter[data-filter="category"]').addEventListener('change', function() {
    const value = this.value;
    const categoryMapping = {
      'VW': 'koronkowe',
      'PR': 'plytkowe',
      'WW': 'vhm',
      'PS': 'sandvik',
      'WK': 'ksem',
      'WV': 'amec'
    };
    
    window.selectedCategory = value ? categoryMapping[value] : 'wszystkie';
    
    // Update active states
    document.querySelectorAll('.wiertla-categories__icon-item').forEach(item => {
      item.classList.remove('active');
      if (item.getAttribute('data-category') === window.selectedCategory) {
        item.classList.add('active');
      }
    });
    
    // Reset to first page when changing filters
    window.WiertlaCNC.filters.page = 1;
    // Apply filters
    applyFilters();
  });

  // Add event listener for manufacturer select
  document.querySelector('.wiertla-categories__filter[data-filter="manufacturer"]').addEventListener('change', function() {
    const value = this.value;
    const manufacturerMapping = {
      'AMEC': 'amec',
      'GÜHRING': 'GÜHRING',
      'ISCAR': 'iscar',
      'KENNAMETAL': 'kennametal',
      'MIKRONTOOL': 'mikrontool',
      'Sandvik': 'sandvik',
      'TaeguTec': 'taegutec',
      'Walter': 'walter',
      'WNT': 'wnt'
    };
    
    window.WiertlaCNC.filters.manufacturer = value ? manufacturerMapping[value] : '';
    
    // Reset to first page when changing filters
    window.WiertlaCNC.filters.page = 1;
    // Apply filters
    applyFilters();
  });
</script>

<script>
  // Add styles for rent button

  // Add click handlers for rent buttons
  document.addEventListener('click', function(e) {
    if (e.target.closest('.wiertla-categories__rent-button, .wiertla-categories__mobile-rent-button')) {
      e.preventDefault();
      e.stopPropagation();
      const button = e.target.closest('.wiertla-categories__rent-button, .wiertla-categories__mobile-rent-button');
      const productId = button.dataset.productId;
      const product = window.WiertlaCNC.products.find(p => p.id === productId);
      if (product) {
        window.WiertlaCNC.openRentModal(product);
      } else {
        console.error('Product not found with ID:', productId);
      }
    }
  });
</script>

  </div>
  
  <!-- Rent Modal -->
  <div id="rent-modal" class="rent-modal">
    <div class="rent-modal__content">
      <div class="rent-modal__header">
        <h2 class="rent-modal__title"></h2>
        <button class="rent-modal__close">
          <img src="{{ 'ico_close.svg' | asset_url }}" alt="Close" width="24" height="24">
        </button>
      </div>
      <div class="rent-modal__body">
        <div class="rent-modal__price"></div>
        <div class="rent-modal__description"></div>
        <div class="rent-modal__form">
          <form id="rent-form">
            <div class="rent-modal__form-group">
              <label for="rent-start-date">Start Date</label>
              <input type="date" id="rent-start-date" name="start-date" required>
            </div>
            <div class="rent-modal__form-group">
              <label for="rent-end-date">End Date</label>
              <input type="date" id="rent-end-date" name="end-date" required>
            </div>
            <button type="submit" class="rent-modal__submit">Rent Now</button>
          </form>
        </div>
      </div>
    </div>
  </div>
  
  <style>
    .rent-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 1000;
    }
    
    .rent-modal__content {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: white;
      padding: 20px;
      border-radius: 8px;
      width: 90%;
      max-width: 500px;
    }
    
    .rent-modal__header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    
    .rent-modal__title {
      margin: 0;
      font-size: 24px;
    }
    
    .rent-modal__close {
      background: none;
      border: none;
      cursor: pointer;
      padding: 0;
    }
    
    .rent-modal__body {
      margin-bottom: 20px;
    }
    
    .rent-modal__price {
      font-size: 20px;
      font-weight: bold;
      margin-bottom: 10px;
    }
    
    .rent-modal__description {
      margin-bottom: 20px;
    }
    
    .rent-modal__form-group {
      margin-bottom: 15px;
    }
    
    .rent-modal__form-group label {
      display: block;
      margin-bottom: 5px;
    }
    
    .rent-modal__form-group input {
      width: 100%;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
    
    .rent-modal__submit {
      width: 100%;
      padding: 10px;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    
    .rent-modal__submit:hover {
      background-color: #0056b3;
    }
  </style>
</div>
