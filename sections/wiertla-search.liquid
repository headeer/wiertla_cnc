{% comment %}
  Wiertla Search Component - Responsive Implementation
{% endcomment %}

<script src="{{ 'wiertla-search.js' | asset_url }}" defer></script>

<div class="wiertla-search" data-search-component>
  <div class="wiertla-search__container">
    <div class="wiertla-search__title" data-translate="common.search">WYSZUKAJ WIERTŁA</div>
    <form class="wiertla-search__form" action="{{ routes.search_url }}" method="get">
      <div class="wiertla-search__input-group">
        <div class="wiertla-search__input-icon">
          <svg
            width="20.48"
            height="22"
            viewBox="0 0 21 22"
            fill="none"
            xmlns="http://www.w3.org/2000/svg">
            <path
              d="M9 17C13.4183 17 17 13.4183 17 9C17 4.58172 13.4183 1 9 1C4.58172 1 1 4.58172 1 9C1 13.4183 4.58172 17 9 17Z"
              stroke="#112832"
              stroke-width="2" />
            <path
              d="M15 15L19.5 19.5"
              stroke="#112832"
              stroke-width="2"
              stroke-linecap="round" />
          </svg>
        </div>
        <input
          type="search"
          name="q"
          id="Search"
          class="wiertla-search__input"
          placeholder="Wpisz szukaną frazę (fi / nazwa / symbol / producent)"
          data-translate-placeholder="wiertla_categories.search_placeholder"
          autocomplete="off"
          aria-label="{{ 'general.search.label' | t }}"
          value="{{ search.terms | escape }}"
          data-search-input>
        <button
          type="button"
          class="wiertla-search__clear"
          aria-label="{{ 'general.search.clear' | t }}">
          <svg
            width="14"
            height="14"
            viewBox="0 0 14 14"
            fill="none">
            <path
              d="M13 1L1 13M1 1L13 13"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round" />
          </svg>
        </button>
      </div>

      <button type="submit" class="wiertla-search__button">
        <span data-translate="common.search">Szukaj</span>
        <svg
          class="wiertla-search__button-icon"
          width="20.48"
          height="22"
          viewBox="0 0 21 22"
          fill="none"
          xmlns="http://www.w3.org/2000/svg">
          <path
            d="M9 17C13.4183 17 17 13.4183 17 9C17 4.58172 13.4183 1 9 1C4.58172 1 1 4.58172 1 9C1 13.4183 4.58172 17 9 17Z"
            stroke="#112832"
            stroke-width="2" />
          <path
            d="M15 15L19.5 19.5"
            stroke="#112832"
            stroke-width="2"
            stroke-linecap="round" />
        </svg>
      </button>

      <div class="wiertla-search__suggestions" hidden>
        <div class="wiertla-search__suggestions-content"></div>
      </div>
    </form>
  </div>
</div>

<style>
  .wiertla-search {
    width: 100%;
    position: relative;
    max-width: 1420px;
    margin: 0 auto 15px;
    padding: 0 64px 30px;
  }
  
  .wiertla-search__container {
    width: 100%;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .wiertla-search__title {
    font-family: 'League Spartan', sans-serif;
    font-weight: 700;
    font-size: 18px;
    line-height: 16.6px;
    letter-spacing: 0.06em;
    text-transform: uppercase;
    color: #112832;
    white-space: nowrap;
  }

  .wiertla-search__form {
    position: relative;
    display: flex;
    align-items: center;
    gap: 10px;
    flex: 1;
  }

  .wiertla-search__input-group {
    position: relative;
    display: flex;
    align-items: center;
    border: 2px solid #E2E2E7;
    border-radius: 30px;
    height: 50px;
    flex: 1;
    max-width: 977px;
    transition: border-color 0.2s ease;
  }

  .wiertla-search__input-group:focus-within {
    border-color: #112832;
  }

  .wiertla-search__input-icon {
    position: absolute;
    left: 17px;
    display: flex;
    align-items: center;
    justify-content: center;
    pointer-events: none;
    transition: opacity 0.2s ease;
  }

  .wiertla-search__input {
    width: 100%;
    height: 100%;
    border: none;
    background: none;
    font-family: 'Montserrat', sans-serif;
    font-weight: 500;
    font-size: 18px;
    line-height: 100%;
    letter-spacing: 0.03em;
    color: inherit;
    padding: 11px 17px 11px 47px;
    transition: padding 0.2s ease;
  }

  .wiertla-search__input:focus {
    outline: none;
    padding-left: 17px;
  }

  .wiertla-search__input::placeholder {
    color: #757575;
    font-family: 'Montserrat', sans-serif;
    font-weight: 500;
    font-size: 18px;
    line-height: 100%;
    letter-spacing: 0.03em;
  }

  .wiertla-search__clear {
    position: absolute;
    right: 17px;
    display: none;
    background: none;
    border: none;
    cursor: pointer;
    padding: 5px;
    color: #757575;
    transition: color 0.2s ease;
  }

  .wiertla-search__clear:hover {
    color: #112832;
  }

  .wiertla-search__button {
    display: flex;
    align-items: center;
    gap: 10px;
    background: #FFE500;
    border: 2px solid #112832;
    border-radius: 30px;
    padding: 11px 20px;
    font-family: 'League Spartan', sans-serif;
    font-weight: 700;
    font-size: 18px;
    line-height: 16.6px;
    letter-spacing: 0.06em;
    text-transform: uppercase;
    color: #112832;
    cursor: pointer;
    transition: background-color 0.2s ease;
    white-space: nowrap;
  }

  .wiertla-search__button:hover {
    background: #FFD700;
  }

  .wiertla-search__suggestions {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background: white;
    border: 1px solid #E2E2E7;
    border-radius: 8px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    z-index: 1000;
  }

  @media screen and (max-width: 768px) {
    .wiertla-search {
      padding: 20px 16px;
    }

    .wiertla-search__container {
      flex-direction: column;
      align-items: flex-start;
      gap: 15px;
    }

    .wiertla-search__form {
      flex-direction: column;
      width: 100%;
      gap: 15px;
    }

    .wiertla-search__input-group {
      width: 100%;
      max-width: 100%;
    }

    .wiertla-search__button {
      width: 100%;
      justify-content: center;
    }
  }
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Enhanced search functionality that works with the sync system
  const searchComponents = document.querySelectorAll('.wiertla-search [data-search-component]');
  
  searchComponents.forEach(component => {
    const form = component.querySelector('.wiertla-search__form');
    const input = component.querySelector('.wiertla-search__input');
    const clearButton = component.querySelector('.wiertla-search__clear');
    const inputIcon = component.querySelector('.wiertla-search__input-icon');
    
    if (!form || !input) return;

    // Handle clear button
    if (clearButton) {
      clearButton.addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        
        input.value = '';
        input.focus();
        toggleClearButton();
        
        // Trigger search sync if available
        if (window.WiertlaSearchSync) {
          window.WiertlaSearchSync.setSearch('');
        }
      });
    }

    // Show/hide clear button and input icon based on input value
    function toggleClearButton() {
      const hasValue = input.value.trim().length > 0;
      if (clearButton) {
        clearButton.style.display = hasValue ? 'block' : 'none';
      }
      if (inputIcon) {
        inputIcon.style.opacity = hasValue ? '0' : '1';
      }
    }

    // Handle input changes
    input.addEventListener('input', function() {
      toggleClearButton();
    });

    // Handle focus/blur for styling
    input.addEventListener('focus', function() {
      if (inputIcon) {
        inputIcon.style.opacity = '0';
      }
    });

    input.addEventListener('blur', function() {
      if (input.value.length === 0 && inputIcon) {
        inputIcon.style.opacity = '1';
      }
    });

    // Initial state
    toggleClearButton();
  });
});
</script>

{% schema %}
  {
    "name": "Wiertla Search",
    "settings": [
      {
        "type": "text",
        "id": "placeholder",
        "label": "Search Placeholder",
        "default": "Wpisz szukaną frazę (fi / nazwa / symbol / producent)"
      }
    ],
    "presets": [
      {
        "name": "Wiertla Search",
        "category": "Custom Sections"
      }
    ]
  }
{% endschema %}

{% stylesheet %}
  .wiertla-search {
    max-width: 1420px;
    margin: 0 auto;
    padding: 30px 64px;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .wiertla-search__container {
    width: 100%;
    display: flex;
    align-items: center;
    gap: 10px;
  }
  .wiertla-search__icon {
    width: 20px;
    height: 22px;

  }
  .wiertla-search__label {
    font-size: 18px;
    line-height: 17px;
    letter-spacing: 0.96px;
    white-space: nowrap;
    text-transform: uppercase;
  }

  .wiertla-search__input-group {
    flex: 1;
    display: flex;
    align-items: center;
    border: 2px solid #E2E2E7;
    border-radius: 30px;
    width: 100%;
    position: relative;
  }

  .wiertla-search__icon {
    width: 20px;
    height: 22px;
    position: absolute;
    right: 14px;
    pointer-events: none;
  }

  .wiertla-search__input {
    flex: 1;
    border: none;
    outline: none;
    padding: 8px 44px 8px 16px;
    font-size: 16px;
    width: 100%;
  }

  .wiertla-search__button {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 22px;
    background-color: var(--color-yellow-300);
    border: 2px solid var(--color-cyan-950);
    border-radius: 40px;
    padding: 8.5px 15px 8.5px 20px;
    font-size: 18px;
    line-height: 17px;
    letter-spacing: 0.96px;
    cursor: pointer;
    width: 220px;
    font-family: "League Spartan";
    font-weight: 700;
    font-size: 18px;
    line-height: 16.6px;
    letter-spacing: 0.06em;
    text-transform: uppercase;
    display: inline-flex;
    align-items: center;
    gap: 22px;
    background: #FFE500;
    border: 2px solid #112832;
    border-radius: 40px;
    cursor: pointer;
    transition: opacity 0.3s;
  }

  .wiertla-search__button-icon {
    width: 20px;
    height: 22px;
  }

  @media (max-width: 768px) {
    .wiertla-search {
      padding: 20px 32px;
      flex-direction: column;
    }

    .wiertla-search__container {
      flex-direction: column;
    }

    .wiertla-search__button {
      width: 100%;
    }
  }
{% endstylesheet %}