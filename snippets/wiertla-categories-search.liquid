{% comment %}
  Wiertla Categories Search Component
  A reusable component to display the search functionality for the Wiertla CNC Shopify theme.
{% endcomment %}
<button class="wiertla-categories__fullscreen-btn">
  <img src="{{ 'zoom_in_map.svg' | asset_url }}" alt="Fullscreen" class="wiertla-categories__fullscreen-icon" width="24" height="24">
  <span data-translate="wiertla_categories.fullscreen_open">Wyświetl tabelę na całej stronie</span>
</button>

<div class="wiertla-categories__search" data-search-component>
  <form class="wiertla-search__form" action="{{ routes.search_url }}" method="get">
    <div class="wiertla-search__input-group">
      <input
        type="search"
        id="CategorySearch"
        name="q"
        class="wiertla-search__input"
        placeholder="fi / nazwa / symbol / producent"
        data-translate-placeholder="wiertla_categories.search_placeholder_short"
        autocomplete="off"
        aria-label="{{ 'general.search.category_label' | t }}"
        value="{{ search.terms | escape }}"
        data-search-input
      >
      <button type="submit" class="wiertla-search__submit" aria-label="Submit">
        <svg xmlns="http://www.w3.org/2000/svg" width="21" height="22" viewBox="0 0 21 22" fill="none">
          <g clip-path="url(#clip0_61_54)">
          <path fill-rule="evenodd" clip-rule="evenodd" d="M1.27539 21.2414L8.8616 12.8966L1.27539 21.2414Z" fill="#112832"/>
          <path d="M1.27539 21.2414L8.8616 12.8966" stroke="#112832" stroke-width="2"/>
          <path d="M13.035 15.1724C17.0153 15.1724 20.2419 11.9458 20.2419 7.9655C20.2419 3.98524 17.0153 0.758606 13.035 0.758606C9.05476 0.758606 5.82812 3.98524 5.82812 7.9655C5.82812 11.9458 9.05476 15.1724 13.035 15.1724Z" stroke="#112832" stroke-width="2"/>
          </g>
          <defs>
          <clipPath id="clip0_61_54">
          <rect width="20.4828" height="22" fill="white" transform="translate(0.517578)"/>
          </clipPath>
          </defs>
          </svg>
      </button>
      <button type="button" class="wiertla-search__clear" aria-label="Clear search">
        <svg width="14" height="14" viewBox="0 0 14 14" fill="none">
          <path d="M13 1L1 13M1 1L13 13" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </button>
    </div>
    <div class="wiertla-search__suggestions" hidden>
      <div class="wiertla-search__suggestions-content"></div>
    </div>
  </form>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Enhanced search functionality with synchronization
  const searchComponent = document.querySelector('[data-search-component]');
  if (!searchComponent) return;

  const form = searchComponent.querySelector('.wiertla-search__form');
  const input = searchComponent.querySelector('.wiertla-search__input');
  const clearButton = searchComponent.querySelector('.wiertla-search__clear');
  const submitButton = searchComponent.querySelector('.wiertla-search__submit');
  
  if (!form || !input) return;

  // Handle clear button
  if (clearButton) {
    clearButton.addEventListener('click', function(e) {
      e.preventDefault();
      e.stopPropagation();
      
      input.value = '';
      input.focus();
      
      // Trigger search sync if available
      if (window.WiertlaSearchSync) {
        window.WiertlaSearchSync.setSearch('');
      }
    });
  }

  // Show/hide clear button based on input value
  function toggleClearButton() {
    if (clearButton) {
      const hasValue = input.value.trim().length > 0;
      clearButton.style.display = hasValue ? 'block' : 'none';
    }
  }

  // Handle input changes
  input.addEventListener('input', function() {
    toggleClearButton();
  });

  // Handle focus/blur for styling
  input.addEventListener('focus', function() {
    searchComponent.classList.add('focused');
  });

  input.addEventListener('blur', function() {
    searchComponent.classList.remove('focused');
  });

  // Initial state
  toggleClearButton();

  // The actual search synchronization is handled by wiertla-search.js
  // This just provides the UI interactions
});
</script>

<div class="wiertla-rental-info">
  <!-- Rental Info - Added below search -->
  {% render 'wiertla-categories-rental-info' %}
</div>

<div class="wiertla-categories__preview" id="tableHoverPreview">
  <h3 class="wiertla-categories__preview-title" data-translate="wiertla_categories.preview_title">ZOBACZ OBRAZ POGLĄDOWY</h3>
  <div class="wiertla-categories__preview-image">
    <img id="tableHoverPreviewImg" src="{{ 'custom_icons.png' | asset_url }}" alt="Preview" class="wiertla-categories__preview-img" width="300" height="200" data-translate-attr="alt:wiertla_categories.preview_title">
  </div>
  <p class="wiertla-categories__preview-text" data-translate="wiertla_categories.preview_instruction">Najedź kursorem na wiertło w tabeli, aby wyświetlić tu powiększony podgląd</p>
</div>

<style>
  .wiertla-categories__preview {
    width: 100%;
    padding: 20px;
    border: 2px dashed #E2E2E7;
    margin-top: 20px;
    transition: all 0.3s ease;
  }
  
  .wiertla-categories__preview.active {
    border: 2px solid #112832;
    background-color: rgba(245, 245, 248, 0.5);
  }
  
  .wiertla-categories__preview-image {
    width: 100%;
    height: auto;
    display: flex;
    align-items: flex-start;
    justify-content: flex-start;
    margin: 15px 0;
    overflow: hidden;
  }
  
  .wiertla-categories__preview-img {
    max-width: 100%;
    max-height: 100%;
    object-fit: contain;
    transition: transform 0.3s ease;
    display: block;
  }
  
  .wiertla-categories__preview.active .wiertla-categories__preview-img {
    transform: scale(1.05);
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
  }
  
  /* Style for when returning to original custom_icons image */
  .wiertla-categories__preview:not(.active) .wiertla-categories__preview-img {
    max-height: 80%;
  }
</style> 