{% paginate customer.addresses by 5 %}

  <div class="section-x-padding py-theme max-w-xl mx-auto" data-color-scheme="primary">
    <div class="mb-8 text-center">
      <h1 class="font-heading text-2xl lg:text-4xl mb-2" data-translate="customer.account.title">Moje konto</h1>
      {%- assign return_url = 'customer.account.return' | t -%}
      <a href="{{ routes.account_url }}" class="w-btn w-btn--outline">{{ return_url }}</a>
    </div>

    <div data-address>
      <button class="w-btn w-btn--primary mb-4" type="button" id="AddressNewButton" data-address-new aria-expanded="false" data-translate="customer.addresses.add_new">Dodaj nowy adres</button>

      <div data-address-form class="hidden pb-8" id="AddressNewForm">
        {% form 'customer_address', customer.new_address %}
          <div class="w-card">
          <h2 class="font-heading text-lg mb-2" data-translate="customer.addresses.add_new">Dodaj nowy adres</h2>

          <div class="text-scheme-accent">
          {% if form.errors %}
              {{ form.errors | default_errors }}
          {% endif %}
          </div>

          <div data-address-fields class="address-form mt-4">
            <div class="form-field">
              <label for="AddressFirstNameNew" data-translate="customer.addresses.first_name">Imię</label>
              <input type="text" name="address[first_name]" id="AddressFirstNameNew" value="{{ form.first_name }}">
            </div>
            <div class="form-field">
              <label for="AddressLastNameNew" data-translate="customer.addresses.last_name">Nazwisko</label>
              <input type="text" name="address[last_name]" id="AddressLastNameNew" value="{{ form.last_name }}">
            </div>
            <div class="form-field">
              <label for="AddressCompanyNew" data-translate="customer.addresses.company">Firma</label>
              <input type="text" name="address[company]" id="AddressCompanyNew" value="{{ form.company }}">
            </div>
            <div class="form-field">
              <label for="AddressAddress1New" data-translate="customer.addresses.address1">Adres</label>
              <input type="text" name="address[address1]" id="AddressAddress1New" value="{{ form.address1 }}">
            </div>
            <div class="form-field">
              <label for="AddressAddress2New" data-translate="customer.addresses.address2">Adres (kontynuacja)</label>
              <input type="text" name="address[address2]" id="AddressAddress2New" value="{{ form.address2 }}">
            </div>
            <div class="form-field">
              <label for="AddressCityNew" data-translate="customer.addresses.city">Miasto</label>
              <input type="text" name="address[city]" id="AddressCityNew" value="{{ form.city }}">
            </div>
            <div class="form-field">
              <label for="AddressCountryNew" data-translate="customer.addresses.country">Kraj</label>
              <select name="address[country]" id="AddressCountryNew" data-default="{{ form.country }}">
                {{ country_option_tags }}
              </select>
            </div>
            <div class="form-field">
              <label for="AddressProvinceNew" data-translate="customer.addresses.province">Województwo</label>
              <input type="text" name="address[province]" id="AddressProvinceNew" value="{{ form.province }}">
            </div>
            <div class="form-field">
              <label for="AddressZipNew" data-translate="customer.addresses.zip">Kod pocztowy</label>
              <input type="text" name="address[zip]" id="AddressZipNew" value="{{ form.zip }}">
            </div>
            <div class="form-field">
              <label for="AddressPhoneNew" data-translate="customer.addresses.phone">Telefon</label>
              <input type="tel" name="address[phone]" id="AddressPhoneNew" value="{{ form.phone }}">
            </div>
          </div>
          <div class="form-field">
            <label>
              <input type="checkbox" name="address[default]" id="AddressDefaultAddressNew">
              <span data-translate="customer.addresses.set_default">Ustaw jako domyślny adres</span>
            </label>
          </div>

          <div class="mt-4">
            <button type="submit" class="w-btn w-btn--primary" data-translate="customer.addresses.add">Dodaj adres</button>
            <button type="button" class="w-btn w-btn--outline" data-address-cancel data-translate="customer.addresses.cancel">Anuluj</button>
          </div>
          </div>
        {% endform %}
      </div>
    </div>

    <h2 class="font-heading text-lg mb-2">{{ 'customer.addresses.title' | t }}</h2>

    <div data-addresses>
      {% for address in customer.addresses %}
        <div data-address>
          <div class="address-item w-card">
            <h2 class="font-heading text-lg mb-2" data-translate="customer.addresses.title">Adres {{ forloop.index }}</h2>
            
            {% if address == customer.default_address %}
              <p><strong data-translate="customer.addresses.default">Domyślny adres</strong></p>
            {% endif %}

            <div class="address-actions">
              <button type="button" class="w-btn w-btn--outline" data-edit-address="{{ address.id }}" data-translate="customer.addresses.edit">Edytuj</button>
              <button type="button" class="w-btn w-btn--ghost" data-delete-address="{{ address.id }}" data-confirm="Czy na pewno chcesz usunąć ten adres?" data-translate="customer.addresses.delete">Usuń</button>
            </div>

            <div class="address-content">
              {{ address | format_address }}
            </div>
          </div>

          <div class="edit-address-form" data-edit-address-form="{{ address.id }}">
            <div class="w-card">
            <h3 class="font-heading text-lg" data-translate="customer.addresses.edit_address">Edytuj adres</h3>

            {% form 'customer_address', address %}
              <div class="form-field">
                <label for="AddressFirstName_{{ address.id }}" data-translate="customer.addresses.first_name">Imię</label>
                <input type="text" name="address[first_name]" id="AddressFirstName_{{ address.id }}" value="{{ form.first_name }}">
              </div>

              <div class="form-field">
                <label for="AddressLastName_{{ address.id }}" data-translate="customer.addresses.last_name">Nazwisko</label>
                <input type="text" name="address[last_name]" id="AddressLastName_{{ address.id }}" value="{{ form.last_name }}">
              </div>

              <div class="form-field">
                <label for="AddressCompany_{{ address.id }}" data-translate="customer.addresses.company">Firma</label>
                <input type="text" name="address[company]" id="AddressCompany_{{ address.id }}" value="{{ form.company }}">
              </div>

              <div class="form-field">
                <label for="AddressAddress1_{{ address.id }}" data-translate="customer.addresses.address1">Adres</label>
                <input type="text" name="address[address1]" id="AddressAddress1_{{ address.id }}" value="{{ form.address1 }}">
              </div>

              <div class="form-field">
                <label for="AddressAddress2_{{ address.id }}" data-translate="customer.addresses.address2">Adres (kontynuacja)</label>
                <input type="text" name="address[address2]" id="AddressAddress2_{{ address.id }}" value="{{ form.address2 }}">
              </div>

              <div class="form-field">
                <label for="AddressCity_{{ address.id }}" data-translate="customer.addresses.city">Miasto</label>
                <input type="text" name="address[city]" id="AddressCity_{{ address.id }}" value="{{ form.city }}">
              </div>

              <div class="form-field">
                <label for="AddressCountry_{{ address.id }}" data-translate="customer.addresses.country">Kraj</label>
                <select name="address[country]" id="AddressCountry_{{ address.id }}" data-default="{{ form.country }}">
                  {{ country_option_tags }}
                </select>
              </div>

              <div class="form-field">
                <label for="AddressProvince_{{ address.id }}" data-translate="customer.addresses.province">Województwo</label>
                <input type="text" name="address[province]" id="AddressProvince_{{ address.id }}" value="{{ form.province }}">
              </div>

              <div class="form-field">
                <label for="AddressZip_{{ address.id }}" data-translate="customer.addresses.zip">Kod pocztowy</label>
                <input type="text" name="address[zip]" id="AddressZip_{{ address.id }}" value="{{ form.zip }}">
              </div>

              <div class="form-field">
                <label for="AddressPhone_{{ address.id }}" data-translate="customer.addresses.phone">Telefon</label>
                <input type="tel" name="address[phone]" id="AddressPhone_{{ address.id }}" value="{{ form.phone }}">
              </div>

              <div class="form-field">
                <label>
                  <input type="checkbox" name="address[default]" id="AddressDefaultAddress_{{ address.id }}" {% if address == customer.default_address %}checked{% endif %}>
                  <span data-translate="customer.addresses.set_default">Ustaw jako domyślny adres</span>
                </label>
              </div>

              <button type="submit" class="w-btn w-btn--primary" data-translate="customer.addresses.update">Aktualizuj adres</button>
              <button type="button" class="w-btn w-btn--outline" data-address-cancel data-translate="customer.addresses.cancel">Anuluj</button>
            {% endform %}
            </div>
          </div>
        </div>
      {% endfor %}
    </div>

    {% if paginate.pages > 1 %}
      {% render 'pagination' with paginate: paginate, section_color: 'primary' %}
    {% endif %}
  </div>
{% endpaginate %}

<script>
  function customerAddressForm() {
    var newAddressForm = document.getElementById('AddressNewForm');
    var newAddressFormButton = document.getElementById('AddressNewButton');

    if (!newAddressForm) {
      return;
    }

    // Initialize observers on address selectors, defined in shopify_common.js
    if (Shopify) {
      // eslint-disable-next-line no-new
      new Shopify.CountryProvinceSelector(
        'AddressCountryNew',
        'AddressProvinceNew',
        {
          hideElement: 'AddressProvinceContainerNew'
        }
      );
    }

    // Initialize each edit form's country/province selector
    document
      .querySelectorAll('.address-country-option')
      .forEach(function(option) {
        var formId = option.dataset.formId;
        var countrySelector = 'AddressCountry_' + formId;
        var provinceSelector = 'AddressProvince_' + formId;
        var containerSelector = 'AddressProvinceContainer_' + formId;
        // eslint-disable-next-line no-new
        new Shopify.CountryProvinceSelector(countrySelector, provinceSelector, {
          hideElement: containerSelector
        });
      });

    // Toggle new/edit address forms
    document.querySelectorAll('[data-address-new]').forEach(function(button) {
      button.addEventListener('click', function() {
        var isExpanded =
          newAddressFormButton.getAttribute('aria-expanded') === 'true';

        newAddressForm.classList.toggle('hidden');
        newAddressFormButton.setAttribute('aria-expanded', !isExpanded);
        newAddressFormButton.focus();
      });
    });

    document.querySelectorAll('[data-address-edit]').forEach(function(button) {
      button.addEventListener('click', function(evt) {
        var formId = evt.target.dataset.addressEdit;
        var editButton = document.getElementById('EditFormButton_' + formId);
        var editAddress = document.getElementById('EditAddress_' + formId);
        var isExpanded = editButton.getAttribute('aria-expanded') === 'true';

        editAddress.classList.toggle('hidden');
        editButton.setAttribute('aria-expanded', !isExpanded);
        editButton.focus();
      });
    });

    document.querySelectorAll('[data-address-delete-form]').forEach(function(button) {
      button.addEventListener('click', function(evt) {
        evt.preventDefault();
        var target = evt.target.dataset.target;
        var confirmMessage = evt.target.dataset.confirmMessage;

        // eslint-disable-next-line no-alert
        if (
          confirm(
            confirmMessage || 'Are you sure you wish to delete this address?'
          )
        ) {
          Shopify.postLink(target, {
            parameters: { _method: 'delete' }
          });
        }
      });
    });
  }

  window.addEventListener('DOMContentLoaded', () => {
    customerAddressForm();
  });
</script>
